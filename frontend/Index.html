<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>RAJA GAME AI</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      /* KRISH AI Theme (Used for both Login and Main Page) */
      --bg-light: #F8F9FA;
      --card-bg: #FFFFFF;
      --border-color: #DEE2E6;
      --text-primary: #212529;
      --text-secondary: #495057;
      --accent-primary: #007BFF;
      --accent-light: #E6F2FF;
      --success: #28A745;
      --danger: #DC3545;
      --shadow-color: rgba(0, 0, 0, 0.06);
      --shadow-color-hover: rgba(0, 0, 0, 0.1);
      --gold: #FFD700; /* Gold for accents */
    }
    /* Theme Variations */
    body.theme-default {
      --accent-primary: #007BFF;
      --accent-light: #E6F2FF;
    }
    body.theme-neon {
      --accent-primary: #FF00FF;
      --accent-light: rgba(255, 0, 255, 0.1);
    }
    body.theme-gold {
      --accent-primary: #FFD700;
      --accent-light: rgba(255, 215, 0, 0.1);
    }
    body.theme-green {
      --accent-primary: #28A745;
      --accent-light: rgba(40, 167, 69, 0.1);
    }
    body.theme-purple {
      --accent-primary: #6F42C1;
      --accent-light: rgba(111, 66, 193, 0.1);
    }
    body.theme-red {
      --accent-primary: #DC3545;
      --accent-light: rgba(220, 53, 69, 0.1);
    }
    body.light-mode {
      --bg-light: #F8F9FA;
      --card-bg: #FFFFFF;
      --border-color: #DEE2E6;
      --text-primary: #212529;
      --text-secondary: #495057;
    }
    body.dark-mode {
      --bg-light: #0f172a;
      --card-bg: #1e293b;
      --border-color: #334155;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --accent-light: rgba(var(--accent-primary-rgb), 0.1);
    }
    body.dark-mode.theme-default { --accent-primary-rgb: 0,123,255; }
    body.dark-mode.theme-neon { --accent-primary-rgb: 255,0,255; }
    body.dark-mode.theme-gold { --accent-primary-rgb: 255,215,0; }
    body.dark-mode.theme-green { --accent-primary-rgb: 40,167,69; }
    body.dark-mode.theme-purple { --accent-primary-rgb: 111,66,193; }
    body.dark-mode.theme-red { --accent-primary-rgb: 220,53,69; }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: "El Messiri", sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      background: linear-gradient(135deg, var(--bg-light), #e9ecef);
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      overflow-x: hidden;
      transition: all 0.3s ease;
      position: relative;
    }
    /* Collapsed/Compact Mobile UI/UX - Reduced Padding, Smaller Fonts, Tighter Spacing */
    @media (max-width: 768px) {
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 0;
      }
      .login-container {
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(20px);
        border-radius: 0;
        min-height: 100vh;
        padding: 1rem 0.5rem; /* Reduced padding */
      }
      .login-box {
        background: rgba(255,255,255,0.95);
        backdrop-filter: blur(10px);
        border: none;
        box-shadow: 0 10px 20px rgba(0,0,0,0.1); /* Reduced shadow */
        border-radius: 16px; /* Smaller radius */
        padding: 1rem; /* Reduced padding */
      }
      .main-app {
        background: linear-gradient(135deg, var(--bg-light), #f8f9fa);
        padding: 1rem 0.5rem 80px 0.5rem; /* Reduced bottom padding */
        border-radius: 16px 16px 0 0; /* Smaller radius */
        margin-top: 0.5rem;
        max-width: 100%;
      }
      .main-title {
        background: linear-gradient(45deg, var(--accent-primary), #ff6b6b);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-size: 2rem; /* Smaller font */
        text-align: center;
      }
      nav {
        background: rgba(255,255,255,0.95);
        backdrop-filter: blur(20px);
        border-top: 1px solid var(--border-color);
        border-radius: 16px 16px 0 0; /* Smaller radius */
        padding: 0.5rem; /* Reduced padding */
        gap: 0.5rem; /* Tighter gap */
      }
      .card {
        background: rgba(255,255,255,0.9);
        backdrop-filter: blur(10px);
        border: none;
        border-radius: 12px; /* Smaller radius */
        box-shadow: 0 5px 15px rgba(0,0,0,0.1); /* Reduced shadow */
        padding: 1rem; /* Reduced padding */
      }
      #tab-games .game-list {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); /* Smaller items */
        gap: 0.5rem; /* Tighter gap */
      }
      .game-item {
        background: linear-gradient(145deg, rgba(255,255,255,0.8), rgba(var(--accent-primary-rgb), 0.1));
        border: 2px solid transparent;
        border-radius: 12px; /* Smaller radius */
        padding: 0.75rem; /* Reduced padding */
        transition: all 0.3s ease;
      }
      .game-item:hover {
        border-color: var(--accent-primary);
        transform: scale(1.02); /* Milder scale */
      }
      .readout-value { font-size: 1.5rem; } /* Smaller readout */
      .history-item { padding: 0.75rem; } /* Tighter history */
      #historyContainer { max-height: 300px; } /* Shorter history */
    }
    /* Login Page Styles - Compact */
    .login-container {
      width: 100%;
      max-width: 400px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding-top: 30px; /* Reduced top padding */
    }
    .login-box {
      background: var(--card-bg);
      padding: 20px; /* Reduced padding */
      border-radius: 12px; /* Smaller radius */
      box-shadow: 0 3px 15px var(--shadow-color); /* Reduced shadow */
      border: 1px solid var(--border-color);
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      width: 100%;
      max-width: 400px;
      position: relative;
      z-index: 1;
    }
    .login-box:hover {
      transform: translateY(-3px); /* Milder lift */
      box-shadow: 0 5px 20px var(--shadow-color-hover);
    }
    .login-logo {
      width: 80px; /* Smaller logo */
      height: 80px;
      border-radius: 50%;
      margin-bottom: 12px; /* Reduced margin */
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: block;
      margin-left: auto;
      margin-right: auto;
      animation: bounce 2s infinite;
    }
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-5px); }
      60% { transform: translateY(-2px); }
    }
    .login-title {
      font-size: 2rem; /* Smaller title */
      font-weight: 700;
      color: var(--accent-primary);
      margin-bottom: 15px; /* Reduced margin */
      letter-spacing: 1px; /* Tighter spacing */
    }
    .form-input {
      width: 100%;
      padding: 10px; /* Reduced padding */
      font-size: 0.9rem; /* Smaller font */
      border: 1px solid var(--border-color);
      border-radius: 6px; /* Smaller radius */
      margin-bottom: 12px; /* Reduced margin */
      text-align: center;
      background: var(--card-bg);
      color: var(--text-primary);
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .form-input::placeholder {
      color: var(--text-secondary);
    }
    .form-input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 2px var(--accent-light); /* Smaller glow */
    }
    .btn {
      width: 100%;
      padding: 10px; /* Reduced padding */
      font-size: 0.9rem; /* Smaller font */
      font-weight: 600;
      border: none;
      border-radius: 6px; /* Smaller radius */
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px; /* Tighter gap */
      font-family: "El Messiri", sans-serif;
    }
    .btn-primary {
      background: var(--accent-primary);
      color: var(--card-bg);
      margin-bottom: 12px; /* Reduced margin */
    }
    .btn-primary:hover {
      filter: brightness(0.9);
      transform: scale(1.01); /* Milder scale */
    }
    .btn.running {
      background: var(--danger) !important;
    }
    .btn.running:hover {
      filter: brightness(0.9);
      transform: scale(1.01);
    }
    .btn.telegram {
      background: #0088CC;
      color: var(--card-bg);
    }
    .btn.telegram:hover {
      background: #00A1E6;
      transform: scale(1.01);
    }
    .error {
      color: var(--danger);
      font-size: 0.8rem; /* Smaller font */
      margin-top: 8px; /* Reduced margin */
    }
    .loading {
      color: var(--accent-primary);
      font-size: 0.8rem;
      margin-top: 8px;
      display: none;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .loading-spinner {
      border: 2px solid rgba(var(--accent-primary-rgb), 0.3); /* Smaller spinner */
      border-top: 2px solid var(--accent-primary);
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    /* Main Page Styles - Compact */
    .main-app {
      font-family: "El Messiri", sans-serif;
      background-color: var(--bg-light);
      padding: 1rem 0.5rem 80px 0.5rem; /* Reduced padding */
      display: none;
      flex-direction: column;
      align-items: center;
      width: 100%;
      min-height: 100vh;
      transition: all 0.3s ease;
    }
    header {
      text-align: center;
      margin-bottom: 1.5rem; /* Reduced margin */
      animation: fadeInDown 0.8s ease-out;
    }
    .main-title {
      font-size: 2.5rem; /* Smaller title */
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: 2px; /* Tighter spacing */
    }
    .main-title span {
      color: var(--accent-primary);
      font-weight: 700;
    }
    .subtitle {
      color: var(--text-secondary);
      font-size: 0.9rem; /* Smaller subtitle */
      margin-top: 0.1rem;
      font-weight: 500;
    }
    main {
      flex-grow: 1;
      max-width: 500px; /* Slightly narrower */
      width: 100%;
      z-index: 10;
    }
    .card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 0.75rem; /* Smaller radius */
      box-shadow: 0 3px 15px var(--shadow-color); /* Reduced shadow */
      transition: all 0.3s ease;
      animation: fadeInUp 0.8s ease-out forwards;
      opacity: 0;
      padding: 1rem; /* Reduced padding */
    }
    .card:hover {
      transform: translateY(-3px); /* Milder lift */
      box-shadow: 0 5px 20px var(--shadow-color-hover);
    }
    nav {
      position: fixed;
      bottom: 0;
      left: 0;
      transform: none;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border-color);
      border-radius: 0;
      display: flex;
      padding: 0.25rem; /* Reduced padding */
      width: 100%;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); /* Reduced shadow */
      z-index: 100;
      transition: all 0.3s ease;
      margin-bottom: 0;
    }
    body.dark-mode nav {
      background: rgba(30,41,59,0.85);
    }
    nav button {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--text-secondary);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.1rem; /* Tighter gap */
      flex-grow: 1;
      padding: 0.25rem 0; /* Reduced padding */
      border-radius: 0.75rem; /* Smaller radius */
      transition: all 0.3s ease;
      font-weight: 600;
      font-size: 0.8rem; /* Smaller text */
    }
    nav button:hover {
      color: var(--accent-primary);
    }
    nav button.active {
      color: var(--accent-primary);
      background-color: var(--accent-light);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .readout-box {
      background-color: var(--bg-light);
      border: 1px solid var(--border-color);
      border-radius: 0.5rem; /* Smaller radius */
      padding: 0.75rem; /* Reduced padding */
      text-align: center;
    }
    .readout-label {
      font-size: 0.8rem; /* Smaller label */
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 0.25rem; /* Reduced margin */
    }
    .readout-value {
      font-size: 1.5rem; /* Smaller value */
      font-weight: 700;
      letter-spacing: 1px;
      line-height: 1.1;
      color: var(--accent-primary);
    }
    .icon-win { color: var(--success); }
    .icon-loss { color: var(--danger); }
    .icon-pending { color: var(--accent-primary); animation: pulse-icon 2s infinite; }
    @keyframes pulse-icon {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }
    #historyContainer {
      max-height: 300px; /* Shorter container */
      overflow-y: auto;
    }
    .history-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem; /* Reduced padding */
      border-bottom: 1px solid #f1f1f1;
      transition: background-color 0.3s;
      color: var(--text-primary);
    }
    body.dark-mode .history-item {
      border-bottom-color: var(--border-color);
    }
    .history-item:last-child {
      border-bottom: none;
    }
    .signal-meter {
      height: 4px; /* Thinner meter */
      background: var(--border-color);
      border-radius: 2px;
      overflow: hidden;
      margin-top: 0.25rem;
    }
    .signal-fill {
      height: 100%;
      border-radius: 2px;
      background: linear-gradient(90deg, var(--accent-primary), var(--success));
      transition: width 1s ease-out;
    }
    .validity-box {
      background-color: var(--bg-light);
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      padding: 0.75rem;
      text-align: center;
      margin-top: 0.75rem;
    }
    .validity-value {
      font-size: 1rem; /* Smaller value */
      font-weight: 600;
      color: var(--text-primary);
    }
    /* Game Selection Styles - Compact */
    #tab-games .game-selection {
      position: relative;
      top: 0;
      left: 0;
      width: 100%;
      height: calc(100vh - 150px); /* Adjusted height */
      background: var(--bg-light);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 0.5rem; /* Reduced padding */
      z-index: 1;
      animation: fadeIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      overflow-y: auto;
      backdrop-filter: blur(10px);
    }
    #tab-games .game-selection-title {
      font-family: 'El Messiri', sans-serif;
      font-weight: 700;
      font-size: 1.8rem; /* Smaller title */
      margin: 0 0 1rem 0; /* Reduced margin */
      background: linear-gradient(45deg, var(--accent-primary), var(--accent-primary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: 2px;
      position: relative;
      display: inline-block;
      text-shadow: 0 0 10px var(--accent-light); /* Reduced glow */
      animation: glow 2s ease-in-out infinite alternate;
    }
    @keyframes glow {
      from { text-shadow: 0 0 5px var(--accent-light); }
      to { text-shadow: 0 0 10px var(--accent-primary), 0 0 15px var(--accent-light); }
    }
    #tab-games .game-list-container {
      width: 100%;
      max-width: 500px; /* Narrower */
      max-height: 100%;
      overflow-y: auto;
      padding: 0 5px; /* Reduced padding */
    }
    #tab-games .game-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); /* Adjusted columns */
      gap: 0.75rem; /* Tighter gap */
      padding: 0 5px 1rem; /* Reduced padding */
    }
    #tab-games .game-item {
      background: linear-gradient(145deg, var(--card-bg), rgba(var(--accent-primary-rgb), 0.05));
      border: 1px solid var(--accent-primary);
      border-radius: 12px; /* Smaller radius */
      padding: 1rem; /* Reduced padding */
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
      text-align: center;
      font-family: 'El Messiri', sans-serif;
      color: var(--text-primary);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* Reduced shadow */
      position: relative;
      overflow: hidden;
      opacity: 0.8;
    }
    #tab-games .game-item:hover {
      transform: translateY(-5px) scale(1.01); /* Milder transform */
      box-shadow: 0 10px 20px var(--accent-light);
      border-color: var(--accent-primary);
      opacity: 1;
    }
    #tab-games .game-name {
      font-size: 1.2rem; /* Smaller name */
      font-weight: 700;
      margin-bottom: 0.25rem; /* Reduced margin */
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    #tab-games .game-item:hover .game-name {
      color: var(--accent-primary);
      text-shadow: 0 0 5px var(--accent-light); /* Reduced shadow */
    }
    #tab-games .game-desc {
      font-size: 0.8rem; /* Smaller desc */
      color: var(--text-secondary);
      opacity: 0.7;
      transition: opacity 0.3s;
    }
    #tab-games .game-item:hover .game-desc {
      opacity: 1;
    }
    #tab-games .fullscreen-iframe {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      border: none;
      z-index: 1000;
      display: none;
      background: #000;
    }
    #tab-games .injector-tape {
      position: fixed;
      right: 1rem; /* Closer to edge */
      top: 50%;
      transform: translateY(-50%);
      width: 40px; /* Smaller button */
      height: 40px;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-primary));
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1001;
      box-shadow: 0 5px 15px var(--accent-light), inset 0 1px 2px rgba(255,255,255,0.2); /* Reduced shadow */
      border: 1px solid rgba(255, 255, 255, 0.3); /* Thinner border */
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
      color: white;
      font-size: 1rem; /* Smaller icon */
    }
    #tab-games .injector-tape:hover {
      transform: translateY(-50%) scale(1.02);
      box-shadow: 0 10px 20px var(--accent-light);
    }
    #tab-games .injector-tape::before {
      content: '\f053'; /* Back icon */
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
    }
    /* Settings Page Styles - Compact */
    .settings-section {
      display: flex;
      flex-direction: column;
      gap: 0.75rem; /* Tighter gap */
    }
    .settings-title {
      font-size: 1.2rem; /* Smaller title */
      font-weight: 700;
      color: var(--text-primary);
      text-align: center;
      margin-bottom: 0.75rem; /* Reduced margin */
    }
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 0.25rem; /* Tighter gap */
    }
    .input-group label {
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 0.8rem; /* Smaller label */
    }
    .input-group input {
      padding: 0.5rem; /* Reduced padding */
      border: 1px solid var(--border-color);
      border-radius: 0.375rem; /* Smaller radius */
      background: var(--card-bg);
      color: var(--text-primary);
      transition: border-color 0.3s;
    }
    .input-group input:focus {
      border-color: var(--accent-primary);
      outline: none;
    }
    .btn-group {
      display: flex;
      gap: 0.75rem; /* Tighter gap */
      margin-top: 0.75rem;
    }
    .btn-group .btn {
      flex: 1;
      width: auto;
    }
    .btn-overlay {
      position: relative;
      overflow: hidden;
    }
    .btn-overlay::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    .btn-overlay:hover::after {
      left: 100%;
    }
    .toggle-group {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.75rem;
      padding: 0.75rem; /* Reduced padding */
      background: var(--bg-light);
      border-radius: 0.5rem;
      border: 1px solid var(--border-color);
      color: var(--text-primary);
    }
    .toggle-switch {
      position: relative;
      width: 40px; /* Smaller toggle */
      height: 20px;
      background: var(--border-color);
      border-radius: 20px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .toggle-switch.active {
      background: var(--accent-primary);
    }
    .toggle-switch::before {
      content: '';
      position: absolute;
      top: 1px;
      left: 1px;
      width: 18px; /* Smaller knob */
      height: 18px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s;
    }
    .toggle-switch.active::before {
      transform: translateX(20px);
    }
    .theme-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); /* Smaller items */
      gap: 0.5rem; /* Tighter gap */
      margin-top: 0.75rem;
    }
    .theme-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      padding: 0.25rem; /* Reduced padding */
      border-radius: 0.375rem;
      transition: all 0.3s;
      border: 2px solid transparent;
    }
    .theme-item:hover {
      border-color: var(--accent-primary);
    }
    .theme-item.active {
      border-color: var(--accent-primary);
      background: var(--accent-light);
    }
    .theme-circle {
      width: 30px; /* Smaller circle */
      height: 30px;
      border-radius: 50%;
      margin-bottom: 0.25rem;
      border: 2px solid white;
      box-shadow: 0 1px 5px rgba(0,0,0,0.1); /* Reduced shadow */
    }
    .theme-name {
      font-size: 0.7rem; /* Smaller name */
      color: var(--text-secondary);
      text-align: center;
    }
    @media (max-width: 500px) {
      .login-box {
        padding: 16px; /* Further reduced */
      }
      .login-title {
        font-size: 1.8rem;
      }
      .form-input, .btn {
        font-size: 0.8rem;
      }
      .main-title {
        font-size: 2rem;
      }
      nav {
        width: 100%;
      }
      #tab-games .game-selection-title {
        font-size: 1.5rem;
      }
    }
    /* Dark mode overrides - Compact */
    body.dark-mode {
      --card-bg: #1e293b;
      --bg-light: #0f172a;
      --border-color: #334155;
      --text-primary: #f1f5f9;
      --text-secondary: #ffffff;
    }
    body.dark-mode .card {
      background: #1e293b;
      border-color: #334155;
    }
    body.dark-mode .readout-box,
    body.dark-mode .validity-box {
      background-color: #0f172a;
      border-color: #334155;
    }
    body.dark-mode nav {
      background: rgba(30,41,59,0.85);
      border-color: #334155;
    }
    body.dark-mode .history-item {
      border-bottom-color: #334155;
      color: var(--text-primary);
    }
    body.dark-mode .input-group input {
      background: #1e293b;
      color: var(--text-primary);
      border-color: #334155;
    }
    body.dark-mode #tab-games .game-item {
      background: linear-gradient(145deg, #1e293b, rgba(var(--accent-primary-rgb), 0.05));
      color: var(--text-primary);
    }
    body.dark-mode #tab-games .game-item .game-desc {
      color: var(--text-secondary);
    }
    body.dark-mode .login-title {
      text-shadow: 0 0 5px var(--accent-light); /* Reduced */
    }
    /* Animated Panda Logo Styles - Compact */
    .panda-container {
      width: 80px; /* Smaller */
      height: 80px;
      margin: 0 auto 12px; /* Reduced margin */
    }
    .panda-svg {
      width: 100%;
      height: 100%;
    }
    .ear-1, .mini-ear-1 {
      transform: translate(0%) rotate(45deg);
    }
    .ear-2, .mini-ear-2 {
      transform: translate(0%) rotate(-45deg);
    }
    .paw {
      animation-name: move-paw;
    }
    .paw-circle-1 {
      animation-name: move-circle-1;
    }
    .paw-circle-2 {
      animation-name: move-circle-2;
    }
    .paw-circle-3 {
      animation-name: move-circle-3;
    }
    .paw-circle-4 {
      animation-name: move-circle-4;
    }
    .paw-circle-5 {
      animation-name: move-circle-5;
    }
    .paw, .paw-circle-1, .paw-circle-2, .paw-circle-3, .paw-circle-4, .paw-circle-5 {
      animation-duration: 1s;
      animation-direction: alternate;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
    }
    @keyframes move-paw {
      from {
        transform: translateX(1%) translateY(1%) rotate(0deg);
      }
      to {
        transform: translateX(7%) translateY(-15%) rotate(10deg);
      }
    }
    @keyframes move-circle-1 {
      from {
        transform: translateX(1%) translateY(1%) rotate(0deg);
      }
      to {
        transform: translateX(7%) translateY(-15%) rotate(10deg);
      }
    }
    @keyframes move-circle-2 {
      from {
        transform: translateX(1%) translateY(1%) rotate(0deg);
      }
      to {
        transform: translateX(7%) translateY(-15%) rotate(10deg);
      }
    }
    @keyframes move-circle-3 {
      from {
        transform: translateX(1%) translateY(1%) rotate(0deg);
      }
      to {
        transform: translateX(7%) translateY(-15%) rotate(10deg);
      }
    }
    @keyframes move-circle-4 {
      from {
        transform: translateX(1%) translateY(1%) rotate(0deg);
      }
      to {
        transform: translateX(7%) translateY(-15%) rotate(10deg);
      }
    }
    @keyframes move-circle-5 {
      from {
        transform: translateX(1%) translateY(1%) rotate(0deg);
      }
      to {
        transform: translateX(7%) translateY(-15%) rotate(10deg);
      }
    }
    /* Pattern Display - Added for showing patterns */
    .pattern-display {
      background: var(--bg-light);
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      padding: 0.75rem;
      margin-top: 0.5rem;
      font-size: 0.8rem;
      color: var(--text-secondary);
      text-align: left;
      max-height: 200px;
      overflow-y: auto;
    }
    .pattern-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.25rem;
      padding: 0.25rem;
      border-radius: 0.25rem;
      background: rgba(var(--accent-primary-rgb), 0.05);
    }
    .pattern-name { font-weight: 600; color: var(--text-primary); }
    .pattern-pred { color: var(--accent-primary); font-weight: bold; }
  </style>
</head>
<body oncontextmenu="return false;" class="light-mode theme-default">
  <div id="loginSection" class="login-container">
    <div class="login-box">
      <div class="panda-container">
        <svg class="panda-svg" viewBox="-50 0 270 150">
          <g fill="#4a4a4a">
            <ellipse class="ear-1" rx="20" ry="25" cx="42" cy="7"></ellipse>
            <ellipse class="ear-2" rx="20" ry="25" cx="71" cy="120"></ellipse>
          </g>
          <g fill="#010101">
            <ellipse class="mini-ear-1" rx="7" ry="10" cx="42" cy="7"></ellipse>
            <ellipse class="mini-ear-2" rx="7" ry="10" cx="71" cy="120"></ellipse>
          </g>
          <circle r="70" cx="80" cy="80" fill="#ffffff"></circle>
          <ellipse rx="10" ry="7" cx="80" cy="102" fill="#010101"></ellipse>
          <g fill="#4a4a4a">
            <ellipse rx="15" ry="19" cx="46" cy="84"></ellipse>
            <ellipse rx="15" ry="19" cx="111" cy="84"></ellipse>
          </g>
          <g fill="#010101">
            <circle r="7" cx="46" cy="79"></circle>
            <circle r="7" cx="111" cy="79"></circle>
          </g>
          <g fill="#ffffff">
            <circle r="3" cx="43" cy="78"></circle>
            <circle r="3" cx="109" cy="78"></circle>
          </g>
          <ellipse class="paw" fill="#4a4a4a" rx="20" ry="25" cx="150" cy="120"></ellipse>
          <g fill="#ffffff">
            <circle class="paw-circle-1" r="4" cx="137" cy="118"></circle>
            <circle class="paw-circle-2" r="4" cx="163" cy="118"></circle>
            <circle class="paw-circle-3" r="5" cx="143" cy="108"></circle>
            <circle class="paw-circle-4" r="5" cx="157" cy="108"></circle>
            <ellipse class="paw-circle-5" rx="10" ry="8" cx="150" cy="127"></ellipse>
          </g>
          <line x1="0" y1="150" x2="150" y2="150" stroke="#dde9af" stroke-width="20"></line>
          <g stroke="green" stroke-width="2">
            <line x1="15" y1="160" x2="15" y2="140"></line>
            <line x1="45" y1="160" x2="45" y2="140"></line>
            <line x1="75" y1="160" x2="75" y2="140"></line>
            <line x1="105" y1="160" x2="105" y2="140"></line>
            <line x1="135" y1="160" x2="135" y2="140"></line>
            <line x1="70" y1="142" x2="40" y2="130"></line>
          </g>
          <g fill="green">
            <polygon points="45, 120 50, 130 60, 137"></polygon>
            <polygon points="50, 139 55, 135 37, 140"></polygon>
          </g>
          <ellipse fill="#4a4a4a" rx="25" ry="20" cx="10" cy="150"></ellipse>
        </svg>
      </div>
      <div class="login-title">RAJA GAME AI</div>
      <input type="text" id="accessKey" placeholder="Enter Access Key" class="form-input">
      <button id="loginButton" class="btn btn-primary">Login</button>
      <button class="btn telegram" onclick="window.open('https://t.me/+5GjlzeLC-ThjMWU1', '_blank')">
        <i class="fab fa-telegram-plane"></i> Get Key
      </button>
      <div class="loading" id="loading">Verifying...<div class="loading-spinner"></div></div>
      <div class="error" id="error"></div>
    </div>
  </div>
  <div id="mainApp" class="main-app">
    <header>
      <h1 class="main-title">RAJA GAME AI</h1>
      <p class="subtitle">by <span>krish</span></p>
    </header>
    <main>
      <section id="tab-games" class="tab-content w-full">
        <div class="game-selection" id="gameSelection">
          <h1 class="game-selection-title">SELECT GAME</h1>
          <div class="game-list-container">
            <div class="game-list">
              <div class="game-item" data-url="https://www.rajaparty7.com/#/" role="button" tabindex="0">
                <div class="game-name">RAJA GAME</div>
                <div class="game-desc">Enter the arena of big wins</div>
              </div>
              <div class="game-item" data-url="http://Okwin.bio" role="button" tabindex="0">
                <div class="game-name">OK WIN</div>
                <div class="game-desc">Unlock your fortune now</div>
              </div>
              <div class="game-item" data-url="https://goagamea.com/#/login" role="button" tabindex="0">
                <div class="game-name">GOA GAME</div>
                <div class="game-desc">Goa vibes, massive payouts</div>
              </div>
              <div class="game-item" data-url="https://www.bigmumbaiq.com/#/login" role="button" tabindex="0">
                <div class="game-name">BIG MUMBAI</div>
                <div class="game-desc">Mumbai's biggest bets</div>
              </div>
              <div class="game-item" data-url="http://tirangagame.top" role="button" tabindex="0">
                <div class="game-name">TIRANGA</div>
                <div class="game-desc">Patriotic wins await</div>
              </div>
              <div class="game-item" data-url="https://51game5.com/#/" role="button" tabindex="0">
                <div class="game-name">51 GAME</div>
                <div class="game-desc">51 ways to victory</div>
              </div>
              <div class="game-item" data-url="https://bdgwin.cc/#/login" role="button" tabindex="0">
                <div class="game-name">BDG WIN</div>
                <div class="game-desc">BDG's winning edge</div>
              </div>
              <div class="game-item" data-url="http://rajawager.com" role="button" tabindex="0">
                <div class="game-name">RAJA WAGER</div>
                <div class="game-desc">Royal wagers, royal rewards</div>
              </div>
              <div class="game-item" data-url="http://55club.game" role="button" tabindex="0">
                <div class="game-name">55 CLUB</div>
                <div class="game-desc">Club exclusive jackpots</div>
              </div>
              <div class="game-item" data-url="https://bharatclub.net/#/login" role="button" tabindex="0">
                <div class="game-name">BHARAT CLUB</div>
                <div class="game-desc">Bharat's elite gaming</div>
              </div>
              <div class="game-item" data-url="https://www.DamanWorld.Asia/#/" role="button" tabindex="0">
                <div class="game-name">DAMAN</div>
                <div class="game-desc">Daman's daring draws</div>
              </div>
              <div class="game-item" data-url="https://www.aatclub.com/#/" role="button" tabindex="0">
                <div class="game-name">91 CLUB</div>
                <div class="game-desc">91 levels of thrill</div>
              </div>
            </div>
          </div>
        </div>
        <iframe id="gameFrame" class="fullscreen-iframe" allowfullscreen aria-label="Game Window"></iframe>
        <button class="injector-tape" id="injectorTape" aria-label="Back to Game Selection"></button>
      </section>
      <section id="tab-home" class="tab-content active w-full space-y-4"> <!-- Tighter space-y -->
        <div class="card p-3"> <!-- Reduced p-3 -->
          <div class="grid grid-cols-2 gap-2"> <!-- Tighter gap -->
            <div class="readout-box">
              <h2 class="readout-label">Period</h2>
              <div id="periodDisplay" class="readout-value">---</div>
            </div>
            <div class="readout-box">
              <h2 class="readout-label">Prediction</h2>
              <div id="predictionDisplay" class="readout-value text-gray-500">...</div>
            </div>
          </div>
          <div class="mt-2 border-t border-gray-200 pt-2"> <!-- Tighter mt/pt -->
            <div class="flex justify-between items-center mb-1">
              <p class="text-xs font-semibold text-secondary">Confidence</p> <!-- Smaller text -->
              <p id="signalStrengthDisplay" class="font-bold text-xs">Calculating...</p>
            </div>
            <div class="signal-meter">
              <div id="signalStrengthBar" class="signal-fill" style="width: 0%"></div>
            </div>
          </div>
          <!-- Added Pattern Display -->
          <div class="pattern-display" id="patternDisplay">
            <div class="text-xs text-secondary">No patterns analyzed yet.</div>
          </div>
        </div>
        <div class="card p-3 w-full"> <!-- Reduced p-3 -->
          <h3 class="font-bold text-base mb-1">System Status</h3> <!-- Smaller text, tighter mb -->
          <div class="space-y-2"> <!-- Tighter space-y -->
            <div class="flex justify-between items-center text-xs"> <!-- Smaller text -->
              <p class="text-secondary">API Connection:</p>
              <p class="font-bold flex items-center gap-1" id="apiStatus"> <!-- Tighter gap -->
                <i class="fa-solid fa-circle-check text-green-500"></i> Active
              </p>
            </div>
            <div class="flex justify-between items-center text-xs">
              <p class="text-secondary">Last Update:</p>
              <p class="font-bold" id="lastUpdateTime">Just now</p>
            </div>
          </div>
        </div>
      </section>
      <section id="tab-history" class="tab-content w-full">
        <div class="card p-2 sm:p-3"> <!-- Reduced padding -->
          <div class="flex justify-between items-center mb-1 p-2"> <!-- Tighter mb/p -->
            <h3 class="text-lg font-bold text-gray-700">History</h3> <!-- Smaller text -->
            <button id="clearHistoryBtn" class="bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center shadow-md hover:bg-red-600 transition"> <!-- Smaller button -->
              <i class="fa-solid fa-trash"></i>
            </button>
          </div>
          <div id="historyContainer">
            <div class="text-center py-4 text-secondary"> <!-- Reduced py -->
              <i class="fa-solid fa-inbox mb-1 text-2xl"></i> <!-- Smaller icon -->
              <p>No history yet.</p>
            </div>
          </div>
        </div>
      </section>
      <section id="tab-settings" class="tab-content w-full">
        <div class="card p-4 w-full space-y-3"> <!-- Reduced p-4, space-y-3 -->
          <h3 class="settings-title">Telegram Prediction</h3>
          <button id="saveSettingsBtn" class="btn btn-primary">Save</button>
          <div class="input-group">
            <label for="botToken">Bot Token</label>
            <input type="text" id="botToken" placeholder="Enter Bot Token">
          </div>
          <div class="input-group">
            <label for="chatId">Chat ID</label>
            <input type="text" id="chatId" placeholder="Enter Chat ID">
          </div>
          <div class="btn-group">
            <button class="btn btn-primary btn-overlay" onclick="startBot()">START</button>
            <button class="btn btn-primary btn-overlay" onclick="stopBot()">STOP</button>
          </div>
          <div class="toggle-group">
            <span>Dark/Light Mode</span>
            <div class="toggle-switch" id="modeToggle"></div>
          </div>
          <div class="theme-grid">
            <div class="theme-item active" data-theme="default">
              <div class="theme-circle" style="background: #007BFF;"></div>
              <div class="theme-name">Default</div>
            </div>
            <div class="theme-item" data-theme="neon">
              <div class="theme-circle" style="background: #FF00FF;"></div>
              <div class="theme-name">Neon</div>
            </div>
            <div class="theme-item" data-theme="gold">
              <div class="theme-circle" style="background: #FFD700;"></div>
              <div class="theme-name">Gold</div>
            </div>
            <div class="theme-item" data-theme="green">
              <div class="theme-circle" style="background: #28A745;"></div>
              <div class="theme-name">Green</div>
            </div>
            <div class="theme-item" data-theme="purple">
              <div class="theme-circle" style="background: #6F42C1;"></div>
              <div class="theme-name">Purple</div>
            </div>
            <div class="theme-item" data-theme="red">
              <div class="theme-circle" style="background: #DC3545;"></div>
              <div class="theme-name">Red</div>
            </div>
          </div>
          <a href="https://t.me/+5GjlzeLC-ThjMWU1" target="_blank" class="btn btn-primary w-full">
            <i class="fab fa-telegram"></i> Join Telegram
          </a>
        </div>
      </section>
      <section id="tab-info" class="tab-content w-full">
        <div class="card p-4 w-full text-center space-y-3"> <!-- Reduced p-4, space-y-3 -->
          <div>
            <h4 class="text-base font-semibold">RAJA GAME AI</h4> <!-- Smaller text -->
            <p class="text-xs text-secondary">by krish</p>
          </div>
          <p class="text-xs text-gray-500 px-2">This tool uses an advanced, multi-logic engine for predictions. Performance is not guaranteed. Use responsibly.</p> <!-- Reduced px -->
          <a href="https://t.me/+5GjlzeLC-ThjMWU1" target="_blank" class="btn btn-primary w-full">
            <i class="fa-brands fa-telegram"></i> Contact Developer
          </a>
          <button id="logoutButton" class="btn btn-primary w-full">
            <i class="fa-solid fa-sign-out-alt"></i> Logout
          </button>
          <div class="validity-box">
            <h2 class="readout-label">Key Validity</h2>
            <div id="validityDisplay" class="validity-value">Checking...</div>
          </div>
        </div>
      </section>
    </main>
    <nav>
      <button class="tab-btn active" data-tab="games"><i class="fa-solid fa-gamepad fa-lg"></i><span class="text-xs">Games</span></button>
      <button class="tab-btn" data-tab="home"><i class="fa-solid fa-house fa-lg"></i><span class="text-xs">Home</span></button>
      <button class="tab-btn" data-tab="history"><i class="fa-solid fa-list-check fa-lg"></i><span class="text-xs">History</span></button>
      <button class="tab-btn" data-tab="settings"><i class="fa-solid fa-gear fa-lg"></i><span class="text-xs">Settings</span></button>
      <button class="tab-btn" data-tab="info"><i class="fa-solid fa-info-circle fa-lg"></i><span class="text-xs">Info</span></button>
    </nav>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getDatabase, ref, get, update, onValue } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
    const firebaseConfig = {
      apiKey: "AIzaSyD7W66vnvef_p_Qs8CJ7_ucjHegrT4-iRQ",
      authDomain: "masstamil-fa915.firebaseapp.com",
      databaseURL: "https://masstamil-fa915-default-rtdb.firebaseio.com",
      projectId: "masstamil-fa915",
      storageBucket: "masstamil-fa915.firebasestorage.app",
      messagingSenderId: "493712872366",
      appId: "1:493712872366:web:48133eb51bd415c4ad6e3f",
      measurementId: "G-8S7CLWQRYB"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    // Allow text input in accessKey field
    document.getElementById('accessKey').addEventListener('keydown', (event) => {
      const allowedKeys = [
        'Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown',
        'Tab', 'Enter', 'Home', 'End'
      ];
      if (allowedKeys.includes(event.key) ||
          (!event.ctrlKey && !event.altKey && !event.metaKey && event.key.length === 1)) {
        return true;
      }
      event.preventDefault();
    });
    // Theme Management
    function applyTheme(themeName) {
      document.body.className = document.body.className.replace(/theme-\w+/g, '').trim();
      document.body.classList.add(`theme-${themeName}`);
      localStorage.setItem('selectedTheme', themeName);
      const rgbMap = {
        default: '0,123,255',
        neon: '255,0,255',
        gold: '255,215,0',
        green: '40,167,69',
        purple: '111,66,193',
        red: '220,53,69'
      };
      document.body.style.setProperty('--accent-primary-rgb', rgbMap[themeName]);
    }
    function loadTheme() {
      const savedTheme = localStorage.getItem('selectedTheme') || 'default';
      applyTheme(savedTheme);
      document.querySelector(`[data-theme="${savedTheme}"]`).classList.add('active');
    }
    // Login Logic
    function getDeviceId() {
      let id = localStorage.getItem("device_id");
      if (!id) {
        id = crypto.randomUUID();
        localStorage.setItem("device_id", id);
      }
      return id;
    }
    async function handleLogin() {
      const key = document.getElementById("accessKey").value.trim();
      const errorDiv = document.getElementById("error");
      const loadingDiv = document.getElementById("loading");
      const deviceId = getDeviceId();
      errorDiv.innerText = "";
      loadingDiv.style.display = "flex";
      if (!key) {
        loadingDiv.style.display = "none";
        errorDiv.innerText = "Please enter an access key.";
        return;
      }
      try {
        const snap = await get(ref(db, `accessKeys/${key}`));
        loadingDiv.style.display = "none";
        if (!snap.exists()) {
          errorDiv.innerText = "Invalid access key.";
          return;
        }
        const data = snap.val();
        if (!data.active) {
          errorDiv.innerText = "Access key is deactivated.";
          return;
        }
        const now = Date.now();
        if (data.expiry && now > data.expiry) {
          errorDiv.innerText = "Access key has expired.";
          return;
        }
        if (data.deviceId && data.deviceId !== deviceId) {
          errorDiv.innerText = "This key is already used on another device.";
          return;
        }
        if (!data.deviceId) {
          await update(ref(db, `accessKeys/${key}`), { deviceId });
        }
        localStorage.setItem("access_key", key);
        localStorage.setItem('loginTimestamp', Date.now());
        showMainApp();
        listenForKeyStatus(key);
        updateValidityDisplay(key);
      } catch (err) {
        loadingDiv.style.display = "none";
        errorDiv.innerText = "Login failed. Check your connection or try again.";
        console.error("Login Error:", err);
      }
    }
    function showMainApp() {
      const loginSection = document.getElementById('loginSection');
      const mainApp = document.getElementById('mainApp');
      loginSection.style.transition = 'opacity 0.3s ease';
      loginSection.style.opacity = '0';
      setTimeout(() => {
        loginSection.style.display = 'none';
        mainApp.style.display = 'flex';
        mainApp.style.transition = 'opacity 0.3s ease';
        mainApp.style.opacity = '0';
        setTimeout(() => {
          mainApp.style.opacity = '1';
          init();
          initGames();
          initSettings();
        }, 50);
      }, 300);
    }
    function logout() {
      const loginSection = document.getElementById('loginSection');
      const mainApp = document.getElementById('mainApp');
      mainApp.style.transition = 'opacity 0.3s ease';
      mainApp.style.opacity = '0';
      setTimeout(() => {
        mainApp.style.display = 'none';
        loginSection.style.display = 'flex';
        loginSection.style.transition = 'opacity 0.3s ease';
        loginSection.style.opacity = '0';
        setTimeout(() => {
          loginSection.style.opacity = '1';
          document.getElementById('accessKey').value = '';
          document.getElementById('error').innerText = '';
        }, 50);
      }, 300);
      localStorage.removeItem("access_key");
      localStorage.removeItem('loginTimestamp');
    }
    function listenForKeyStatus(key) {
      const keyRef = ref(db, `accessKeys/${key}`);
      onValue(keyRef, (snapshot) => {
        if (!snapshot.exists()) {
          console.log(`Key ${key} deleted from Firebase`);
          logout();
          document.getElementById('error').innerText = "Access key was deleted.";
        } else {
          const data = snapshot.val();
          if (!data.active) {
            console.log(`Key ${key} deactivated`);
            logout();
            document.getElementById('error').innerText = "Access key was deactivated.";
          }
        }
      }, (error) => {
        console.error("Key Listener Error:", error);
        logout();
        document.getElementById('error').innerText = "Session error. Please log in again.";
      });
    }
    function updateValidityDisplay(key) {
      const validityDisplay = document.getElementById('validityDisplay');
      const keyRef = ref(db, `accessKeys/${key}`);
      get(keyRef).then((snapshot) => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          if (!data.expiry) {
            validityDisplay.textContent = 'Permanent';
            return;
          }
          updateRemainingTime(data.expiry);
        }
      });
      const intervalId = setInterval(() => {
        get(keyRef).then((snapshot) => {
          if (snapshot.exists()) {
            const data = snapshot.val();
            if (!data.expiry) {
              validityDisplay.textContent = 'Permanent';
            } else {
              updateRemainingTime(data.expiry);
            }
          } else {
            clearInterval(intervalId);
            logout();
            document.getElementById('error').innerText = "Access key was deleted.";
          }
        });
      }, 1000);
      function updateRemainingTime(expiry) {
        const now = Date.now();
        const diffMs = expiry - now;
        if (diffMs <= 0) {
          validityDisplay.textContent = 'Expired';
          clearInterval(intervalId);
          logout();
          document.getElementById('error').innerText = "Access key has expired.";
          return;
        }
        const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diffMs % (1000 * 60)) / 1000);
        let validityText = '';
        if (days > 0) {
          validityText = `${days}d ${hours}h ${minutes}m ${seconds}s`;
        } else if (hours > 0) {
          validityText = `${hours}h ${minutes}m ${seconds}s`;
        } else if (minutes > 0) {
          validityText = `${minutes}m ${seconds}s`;
        } else {
          validityText = `${seconds}s`;
        }
        validityDisplay.textContent = validityText;
      }
    }
    function checkAutoLogout() {
      const loginTimestamp = localStorage.getItem('loginTimestamp');
      if (loginTimestamp) {
        const now = Date.now();
        const hoursPassed = (now - loginTimestamp) / (1000 * 60 * 60);
        if (hoursPassed > 12) {
          logout();
          document.getElementById('error').innerText = "Session expired. Please log in again.";
        }
      }
    }
    document.getElementById("loginButton").addEventListener("click", handleLogin);
    document.getElementById("logoutButton").addEventListener("click", logout);
    window.addEventListener('DOMContentLoaded', () => {
      loadTheme();
      const body = document.body;
      const isDark = localStorage.getItem('darkMode') === 'true';
      if (isDark) {
        body.classList.remove('light-mode');
        body.classList.add('dark-mode');
      }
      const savedKey = localStorage.getItem("access_key");
      document.getElementById('loginSection').style.display = 'flex';
      document.getElementById('mainApp').style.display = 'none';
      if (savedKey) {
        document.getElementById("accessKey").value = savedKey;
        checkAutoLogout();
        handleLogin();
      } else {
        getDeviceId();
        document.getElementById('loginSection').style.opacity = '1';
      }
    });
    // KRISH AI Logic (Enhanced Prediction - Collapsed Methods)
    let predictionHistory = [];
    let lastCheckedPeriod = null;
    let currentPrediction = null;
    const SKIP_THRESHOLD = 60;
    const ui = {
      period: document.getElementById('periodDisplay'),
      prediction: document.getElementById('predictionDisplay'),
      history: document.getElementById('historyContainer'),
      apiStatus: document.getElementById('apiStatus'),
      lastUpdate: document.getElementById('lastUpdateTime'),
      signalDisplay: document.getElementById('signalStrengthDisplay'),
      signalBar: document.getElementById('signalStrengthBar'),
      clearBtn: document.getElementById('clearHistoryBtn'),
      patternDisplay: document.getElementById('patternDisplay'),
      tabs: document.querySelectorAll('.tab-btn'),
      contents: document.querySelectorAll('.tab-content')
    };
    ui.tabs.forEach(button => {
      button.addEventListener('click', () => {
        const tabId = button.getAttribute('data-tab');
        ui.tabs.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        ui.contents.forEach(content => {
          content.classList.remove('active');
          content.style.display = 'none';
        });
        const activeTab = document.getElementById(`tab-${tabId}`);
        activeTab.classList.add('active');
        activeTab.style.display = 'block';
        activeTab.querySelectorAll('.card').forEach((card, index) => {
          card.style.animation = 'none';
          void card.offsetWidth;
          card.style.animation = `fadeInUp 0.6s ease-out ${index * 0.1}s forwards`;
        });
      });
    });
    ui.clearBtn.addEventListener('click', () => {
      if (confirm('Clear prediction history?')) {
        predictionHistory = [];
        updateHistoryDisplay();
      }
    });
    const API_URL = 'https://draw.ar-lottery01.com/WinGo/WinGo_1M/GetHistoryIssuePage.json';
    async function fetchHistory() {
      try {
        const response = await fetch(`${API_URL}?t=${new Date().getTime()}`, { cache: 'no-store' });
        if (!response.ok) throw new Error('Network response failed');
        const data = await response.json();
        if (!data || !data.data || !data.data.list) throw new Error('Invalid API data structure');
        ui.apiStatus.innerHTML = `<i class="fa-solid fa-circle-check text-green-500"></i> Active`;
        processApiData(data.data.list);
      } catch (error) {
        console.error("Fetch Error:", error);
        ui.apiStatus.innerHTML = `<i class="fa-solid fa-circle-xmark text-red-500"></i> Error`;
      }
    }
    function processApiData(results) {
      const latest = results[0];
      if (latest && latest.issueNumber !== lastCheckedPeriod) {
        lastCheckedPeriod = latest.issueNumber;
        updatePredictionStatuses(results);
        const nextPeriod = (BigInt(latest.issueNumber) + 1n).toString();
        const { prediction, confidence, patterns } = krishAIPredictionEngine(results); // Collapsed engine with patterns
        if (!predictionHistory.some(p => p.period === nextPeriod)) {
          predictionHistory.unshift({ period: nextPeriod, prediction, status: 'pending', patterns, confidence });
        }
        if (predictionHistory.length > 50) predictionHistory.pop();
        currentPrediction = { period: nextPeriod, prediction };
        updateUI(nextPeriod, prediction, confidence, patterns);
      }
      ui.lastUpdate.textContent = new Date().toLocaleTimeString();
    }
    function updatePredictionStatuses(results) {
      predictionHistory.forEach(p => {
        if (p.status === 'pending') {
          const result = results.find(r => r.issueNumber === p.period);
          if (result) {
            const number = parseInt(result.number, 10);
            let actual;
            if (number === 0 || number === 5) {
              actual = (number === 5) ? 'BIG' : 'SMALL';
            } else {
              actual = number >= 5 ? 'BIG' : 'SMALL';
            }
            p.actual = actual;
            if (p.prediction === 'SKIP') {
              p.status = 'skip';
            } else {
              p.status = (p.prediction.toLowerCase() === actual.toLowerCase()) ? 'win' : 'loss';
            }
          }
        }
      });
    }
    function updateUI(nextPeriod, prediction, confidence, patterns) {
      ui.period.textContent = nextPeriod.slice(-4);
      ui.prediction.textContent = prediction === 'SKIP' ? 'SKIP' : prediction.toUpperCase();
      ui.prediction.style.color = prediction === 'SKIP' ? 'var(--text-secondary)' : prediction === 'BIG' ? 'var(--success)' : 'var(--danger)';
      ui.signalDisplay.textContent = prediction === 'SKIP' ? 'Skipped' : `${confidence.toFixed(1)}%`;
      ui.signalBar.style.width = prediction === 'SKIP' ? '0%' : `${confidence}%`;
      updateHistoryDisplay();
      // Update pattern display
      updatePatternDisplay(patterns);
    }
    function updatePatternDisplay(patterns) {
      if (!patterns || patterns.length === 0) {
        ui.patternDisplay.innerHTML = '<div class="text-xs text-secondary">No patterns analyzed yet.</div>';
        return;
      }
      ui.patternDisplay.innerHTML = patterns.map(p => `
        <div class="pattern-item">
          <span class="pattern-name">${p.name}</span>
          <span class="pattern-pred">${p.pred}</span>
        </div>
      `).join('');
    }
    function updateHistoryDisplay() {
      if (predictionHistory.length === 0) {
        ui.history.innerHTML = `<div class="text-center py-4 text-secondary"><i class="fa-solid fa-inbox mb-1 text-2xl"></i><p>No history yet.</p></div>`;
        return;
      }
      const wins = predictionHistory.filter(h => h.status === 'win').length;
      const losses = predictionHistory.filter(h => h.status === 'loss').length;
      const skips = predictionHistory.filter(h => h.status === 'skip').length;
      ui.history.innerHTML = `
        <div class="flex justify-around items-center mb-2 p-2" style="background: var(--bg-light); border-radius: 0.5rem; border: 1px solid var(--border-color);">
          <span class="font-bold text-sm" style="color: var(--success);">Wins: ${wins}</span>
          <span class="font-bold text-sm" style="color: var(--danger);">Losses: ${losses}</span>
          <span class="font-bold text-sm" style="color: var(--text-secondary);">Skips: ${skips}</span>
        </div>
        ${predictionHistory.slice(0, 20).map(item => {
          let iconClass = item.status === 'win' ? 'icon-win fa-trophy' :
                          item.status === 'loss' ? 'icon-loss fa-shield-halved' :
                          item.status === 'skip' ? 'fa-ban' :
                          'icon-pending fa-clock';
          let iconHtml = `<i class="fa-solid ${iconClass} text-lg w-5 text-center"></i>`;
          if (item.status === 'skip') {
            iconHtml = `<i class="fa-solid fa-ban text-gray-500 text-lg w-5 text-center"></i>`;
          }
          const predColor = item.status === 'win' ? 'var(--success)' :
                            item.status === 'loss' ? 'var(--danger)' :
                            item.status === 'skip' ? 'var(--text-secondary)' :
                            'var(--accent-primary)';
          return `
            <div class="history-item">
              <div class="flex items-center gap-2">
                ${iconHtml}
                <div>
                  <p class="font-bold text-sm">Period ${item.period.slice(-4)}</p>
                  <p class="text-xs text-secondary">
                    Actual: ${item.actual ? item.actual.toUpperCase() : '---'}
                  </p>
                </div>
              </div>
              <div class="font-bold text-xs" style="color: ${predColor};">${item.prediction.toUpperCase()}</div>
            </div>`;
        }).join('')}
      `;
    }
    function init() {
      fetchHistory();
      setInterval(fetchHistory, 4000);
      updateHistoryDisplay();
    }
    // Collapsed KRISH AI Prediction Engine (Merged into 2 Main Methods: Trend-Based & Statistical)
    const krishAIPredictionEngine = (history) => {
      const classify = (num) => parseInt(num, 10) >= 5 ? 'BIG' : 'SMALL';
      const bigSmallHistory = history.map(h => classify(h.number));
      const numbers = history.map(h => parseInt(h.number, 10));
      const issues = history.map(h => h.issueNumber);
      // Collapsed Strategies: Grouped into 2 methods
      const trendBased = []; // Trend, reversal, frequency, alternating, duoStreak, trioFlip, sequenceGap, cycleDetector, breakoutPattern
      const statistical = []; // Moving avg, volatility, RSI-like, Bollinger-like, momentum, weighted recent, harmonic mean, entropy, consensus
      // Trend-Based Method (Weight: 0.6 total)
      const recentTrend = bigSmallHistory.slice(0, 10);
      const bigTrendCount = recentTrend.filter(bs => bs === 'BIG').length;
      const trendPred = bigTrendCount > 5 ? 'BIG' : 'SMALL';
      const reversalPred = bigSmallHistory[0] === 'BIG' ? 'SMALL' : 'BIG';
      const freqPred = bigTrendCount > 5 ? 'BIG' : 'SMALL'; // Simplified frequency
      const altPred = (bigSmallHistory[0] !== bigSmallHistory[1]) ? reversalPred : trendPred;
      const duoPred = (bigSmallHistory[0] === bigSmallHistory[1]) ? bigSmallHistory[0] : reversalPred;
      const trioPred = (bigSmallHistory[0] === bigSmallHistory[1] && bigSmallHistory[1] === bigSmallHistory[2]) ? reversalPred : trendPred;
      const seqGapPred = bigTrendCount > recentTrend.length / 2 ? 'SMALL' : 'BIG';
      const cyclePred = (bigSmallHistory[0] === bigSmallHistory[3]) ? reversalPred : trendPred;
      const breakoutPred = numbers[0] > Math.max(...numbers.slice(0, 5)) ? 'BIG' : 'SMALL';
      trendBased.push({ name: 'Trend', pred: trendPred, w: 0.15 });
      trendBased.push({ name: 'Reversal', pred: reversalPred, w: 0.10 });
      trendBased.push({ name: 'Frequency', pred: freqPred, w: 0.08 });
      trendBased.push({ name: 'Alternating', pred: altPred, w: 0.07 });
      trendBased.push({ name: 'Duo Streak', pred: duoPred, w: 0.06 });
      trendBased.push({ name: 'Trio Flip', pred: trioPred, w: 0.05 });
      trendBased.push({ name: 'Seq Gap', pred: seqGapPred, w: 0.04 });
      trendBased.push({ name: 'Cycle', pred: cyclePred, w: 0.03 });
      trendBased.push({ name: 'Breakout', pred: breakoutPred, w: 0.05 });
      // Statistical Method (Weight: 0.4 total)
      const recentNums = numbers.slice(0, 10);
      const avg = recentNums.reduce((a, b) => a + b, 0) / recentNums.length;
      const statPred = avg >= 4.5 ? 'BIG' : 'SMALL';
      const volPred = recentNums.reduce((acc, curr, i) => i > 0 ? acc + Math.abs(curr - recentNums[i-1]) : acc, 0) / recentNums.length > 2 ? reversalPred : statPred;
      const rsiPred = (() => { // Simplified RSI
        let gains = 0, losses = 0;
        for (let i = 1; i < 6; i++) {
          const change = numbers[i-1] - numbers[i];
          if (change > 0) gains += change; else losses -= change;
        }
        const rs = (gains / 5) / (losses / 5);
        const rsi = 100 - (100 / (1 + rs));
        return rsi > 70 ? 'SMALL' : (rsi < 30 ? 'BIG' : statPred);
      })();
      const bollPred = (() => { // Simplified Bollinger
        const mean = avg;
        const variance = recentNums.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / recentNums.length;
        const stdDev = Math.sqrt(variance);
        const last = numbers[0];
        if (last > mean + (2 * stdDev)) return 'SMALL';
        if (last < mean - (2 * stdDev)) return 'BIG';
        return statPred;
      })();
      const momPred = ((numbers[0] - numbers[4]) / numbers[4] > 0.1) ? 'BIG' : 'SMALL';
      const wRecentPred = (() => { // Simplified weighted
        let sum = 0, wSum = 0;
        for (let i = 0; i < 5; i++) {
          const w = (i + 1) / 15;
          sum += numbers[i] * w;
          wSum += w;
        }
        return (sum / wSum) >= 4.5 ? 'BIG' : 'SMALL';
      })();
      const harmPred = (() => { // Simplified harmonic
        const sumRecip = recentNums.slice(0, 5).reduce((a, b) => a + (1 / b), 0);
        const hMean = 5 / sumRecip;
        return hMean >= 4.5 ? 'BIG' : 'SMALL';
      })();
      const entPred = (() => { // Simplified entropy
        const bigC = recentTrend.filter(bs => bs === 'BIG').length;
        const pBig = bigC / recentTrend.length;
        const entropy = - (pBig * Math.log2(pBig + 1e-10) + (1 - pBig) * Math.log2(1 - pBig + 1e-10));
        return entropy > 0.9 ? statPred : (bigC > 5 ? 'SMALL' : 'BIG');
      })();
      statistical.push({ name: 'Moving Avg', pred: statPred, w: 0.10 });
      statistical.push({ name: 'Volatility', pred: volPred, w: 0.08 });
      statistical.push({ name: 'RSI', pred: rsiPred, w: 0.07 });
      statistical.push({ name: 'Bollinger', pred: bollPred, w: 0.06 });
      statistical.push({ name: 'Momentum', pred: momPred, w: 0.05 });
      statistical.push({ name: 'Weighted Recent', pred: wRecentPred, w: 0.04 });
      statistical.push({ name: 'Harmonic', pred: harmPred, w: 0.03 });
      statistical.push({ name: 'Entropy', pred: entPred, w: 0.04 });
      // Consensus: Weighted average of both methods
      let bigScore = 0, smallScore = 0;
      [...trendBased, ...statistical].forEach(s => {
        if (s.pred === 'BIG') bigScore += s.w;
        else if (s.pred === 'SMALL') smallScore += s.w;
      });
      const prediction = bigScore > smallScore ? 'BIG' : 'SMALL';
      const totalWeight = bigScore + smallScore;
      let confidence = 50;
      if (totalWeight > 0) {
        const diff = Math.abs(bigScore - smallScore) / totalWeight;
        confidence = 50 + (diff * 50);
      }
      confidence = Math.min(99, Math.max(51, confidence));
      if (new Date().getSeconds() % 10 === 0) confidence -= 2;
      const patterns = [...trendBased, ...statistical]; // All patterns for full display
      if (confidence < SKIP_THRESHOLD) {
        return { prediction: 'SKIP', confidence: 0, patterns };
      }
      return { prediction, confidence, patterns };
    };
    // Games Integration
    function initGames() {
      const gameSelection = document.getElementById('gameSelection');
      const gameFrame = document.getElementById('gameFrame');
      const gameItems = document.querySelectorAll('#tab-games .game-item');
      const injectorTape = document.getElementById('injectorTape');
      gameItems.forEach(item => {
        item.addEventListener('click', function() {
          const gameUrl = this.getAttribute('data-url');
          gameFrame.src = gameUrl;
          gameSelection.style.display = 'none';
          gameFrame.style.display = 'block';
          injectorTape.style.display = 'flex';
          this.classList.add('active');
          setTimeout(() => this.classList.remove('active'), 500);
        });
      });
      injectorTape.addEventListener('click', function() {
        gameFrame.style.display = 'none';
        gameSelection.style.display = "flex";
        injectorTape.style.display = 'none';
        gameFrame.src = '';
      });
      setTimeout(() => {
        document.querySelector('.game-selection-title').classList.add('animate');
      }, 500);
    }
    // Settings Integration
    function initSettings() {
      const modeToggle = document.getElementById('modeToggle');
      const body = document.body;
      const isDark = localStorage.getItem('darkMode') === 'true';
      if (isDark) {
        body.classList.remove('light-mode');
        body.classList.add('dark-mode');
        modeToggle.classList.add('active');
      }
      modeToggle.addEventListener('click', () => {
        if (body.classList.contains('light-mode')) {
          body.classList.remove('light-mode');
          body.classList.add('dark-mode');
          localStorage.setItem('darkMode', 'true');
        } else {
          body.classList.remove('dark-mode');
          body.classList.add('light-mode');
          localStorage.setItem('darkMode', 'false');
        }
        modeToggle.classList.toggle('active');
      });
      document.getElementById('saveSettingsBtn').addEventListener('click', () => {
        const botToken = document.getElementById('botToken').value;
        const chatId = document.getElementById('chatId').value;
        localStorage.setItem('botToken', botToken);
        localStorage.setItem('chatId', chatId);
        alert('Settings saved!');
      });
      // Theme selection
      document.querySelectorAll('.theme-item').forEach(item => {
        item.addEventListener('click', function() {
          document.querySelectorAll('.theme-item').forEach(i => i.classList.remove('active'));
          this.classList.add('active');
          const theme = this.dataset.theme;
          applyTheme(theme);
        });
      });
      // Load saved settings
      document.getElementById('botToken').value = localStorage.getItem('botToken') || '';
      document.getElementById('chatId').value = localStorage.getItem('chatId') || '';
    }
    // Backend Integration for Bot Control
    const BACKEND_URL = "https://rajagame-ai.onrender.com";
    function startBot() {
      const botToken = document.getElementById("botToken").value.trim();
      const chatId = document.getElementById("chatId").value.trim();

      if (!botToken || !chatId) {
        alert("Please enter Bot Token and Chat ID");
        return;
      }

      fetch(`${BACKEND_URL}/start`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          botToken: botToken,
          chatId: chatId
        })
      })
      .then(res => res.json())
      .then(data => {
        alert("Bot Started Successfully");
        console.log(data);
      })
      .catch(err => {
        alert("Backend not reachable");
        console.error(err);
      });
    }

    function stopBot() {
      fetch(`${BACKEND_URL}/stop`, {
        method: "POST"
      })
      .then(res => res.json())
      .then(data => {
        alert("Bot Stopped");
        console.log(data);
      })
      .catch(err => {
        alert("Backend not reachable");
        console.error(err);
      });
    }
  </script>
</body>
</html>    body.theme-gold {
      --accent-primary: #FFD700;
      --accent-light: rgba(255, 215, 0, 0.1);
    }
    body.theme-green {
      --accent-primary: #28A745;
      --accent-light: rgba(40, 167, 69, 0.1);
    }
    body.theme-purple {
      --accent-primary: #6F42C1;
      --accent-light: rgba(111, 66, 193, 0.1);
    }
    body.theme-red {
      --accent-primary: #DC3545;
      --accent-light: rgba(220, 53, 69, 0.1);
    }
    body.light-mode {
      --bg-light: #F8F9FA;
      --card-bg: #FFFFFF;
      --border-color: #DEE2E6;
      --text-primary: #212529;
      --text-secondary: #495057;
    }
    body.dark-mode {
      --bg-light: #0f172a;
      --card-bg: #1e293b;
      --border-color: #334155;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --accent-light: rgba(var(--accent-primary-rgb), 0.1);
    }
    body.dark-mode.theme-default { --accent-primary-rgb: 0,123,255; }
    body.dark-mode.theme-neon { --accent-primary-rgb: 255,0,255; }
    body.dark-mode.theme-gold { --accent-primary-rgb: 255,215,0; }
    body.dark-mode.theme-green { --accent-primary-rgb: 40,167,69; }
    body.dark-mode.theme-purple { --accent-primary-rgb: 111,66,193; }
    body.dark-mode.theme-red { --accent-primary-rgb: 220,53,69; }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: "El Messiri", sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      background: linear-gradient(135deg, var(--bg-light), #e9ecef);
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      overflow-x: hidden;
      transition: all 0.3s ease;
      position: relative;
    }
    /* Collapsed/Compact Mobile UI/UX - Reduced Padding, Smaller Fonts, Tighter Spacing */
    @media (max-width: 768px) {
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 0;
      }
      .login-container {
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(20px);
        border-radius: 0;
        min-height: 100vh;
        padding: 1rem 0.5rem; /* Reduced padding */
      }
      .login-box {
        background: rgba(255,255,255,0.95);
        backdrop-filter: blur(10px);
        border: none;
        box-shadow: 0 10px 20px rgba(0,0,0,0.1); /* Reduced shadow */
        border-radius: 16px; /* Smaller radius */
        padding: 1rem; /* Reduced padding */
      }
      .main-app {
        background: linear-gradient(135deg, var(--bg-light), #f8f9fa);
        padding: 1rem 0.5rem 80px 0.5rem; /* Reduced bottom padding */
        border-radius: 16px 16px 0 0; /* Smaller radius */
        margin-top: 0.5rem;
        max-width: 100%;
      }
      .main-title {
        background: linear-gradient(45deg, var(--accent-primary), #ff6b6b);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-size: 2rem; /* Smaller font */
        text-align: center;
      }
      nav {
        background: rgba(255,255,255,0.95);
        backdrop-filter: blur(20px);
        border-top: 1px solid var(--border-color);
        border-radius: 16px 16px 0 0; /* Smaller radius */
        padding: 0.5rem; /* Reduced padding */
        gap: 0.5rem; /* Tighter gap */
      }
      .card {
        background: rgba(255,255,255,0.9);
        backdrop-filter: blur(10px);
        border: none;
        border-radius: 12px; /* Smaller radius */
        box-shadow: 0 5px 15px rgba(0,0,0,0.1); /* Reduced shadow */
        padding: 1rem; /* Reduced padding */
      }
      #tab-games .game-list {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); /* Smaller items */
        gap: 0.5rem; /* Tighter gap */
      }
      .game-item {
        background: linear-gradient(145deg, rgba(255,255,255,0.8), rgba(var(--accent-primary-rgb), 0.1));
        border: 2px solid transparent;
        border-radius: 12px; /* Smaller radius */
        padding: 0.75rem; /* Reduced padding */
        transition: all 0.3s ease;
      }
      .game-item:hover {
        border-color: var(--accent-primary);
        transform: scale(1.02); /* Milder scale */
      }
      .readout-value { font-size: 1.5rem; } /* Smaller readout */
      .history-item { padding: 0.75rem; } /* Tighter history */
      #historyContainer { max-height: 300px; } /* Shorter history */
    }
    /* Login Page Styles - Compact */
    .login-container {
      width: 100%;
      max-width: 400px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding-top: 30px; /* Reduced top padding */
    }
    .login-box {
      background: var(--card-bg);
      padding: 20px; /* Reduced padding */
      border-radius: 12px; /* Smaller radius */
      box-shadow: 0 3px 15px var(--shadow-color); /* Reduced shadow */
      border: 1px solid var(--border-color);
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      width: 100%;
      max-width: 400px;
      position: relative;
      z-index: 1;
    }
    .login-box:hover {
      transform: translateY(-3px); /* Milder lift */
      box-shadow: 0 5px 20px var(--shadow-color-hover);
    }
    .login-logo {
      width: 80px; /* Smaller logo */
      height: 80px;
      border-radius: 50%;
      margin-bottom: 12px; /* Reduced margin */
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: block;
      margin-left: auto;
      margin-right: auto;
      animation: bounce 2s infinite;
    }
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-5px); }
      60% { transform: translateY(-2px); }
    }
    .login-title {
      font-size: 2rem; /* Smaller title */
      font-weight: 700;
      color: var(--accent-primary);
      margin-bottom: 15px; /* Reduced margin */
      letter-spacing: 1px; /* Tighter spacing */
    }
    .form-input {
      width: 100%;
      padding: 10px; /* Reduced padding */
      font-size: 0.9rem; /* Smaller font */
      border: 1px solid var(--border-color);
      border-radius: 6px; /* Smaller radius */
      margin-bottom: 12px; /* Reduced margin */
      text-align: center;
      background: var(--card-bg);
      color: var(--text-primary);
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .form-input::placeholder {
      color: var(--text-secondary);
    }
    .form-input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 2px var(--accent-light); /* Smaller glow */
    }
    .btn {
      width: 100%;
      padding: 10px; /* Reduced padding */
      font-size: 0.9rem; /* Smaller font */
      font-weight: 600;
      border: none;
      border-radius: 6px; /* Smaller radius */
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px; /* Tighter gap */
      font-family: "El Messiri", sans-serif;
    }
    .btn-primary {
      background: var(--accent-primary);
      color: var(--card-bg);
      margin-bottom: 12px; /* Reduced margin */
    }
    .btn-primary:hover {
      filter: brightness(0.9);
      transform: scale(1.01); /* Milder scale */
    }
    .btn.running {
      background: var(--danger) !important;
    }
    .btn.running:hover {
      filter: brightness(0.9);
      transform: scale(1.01);
    }
    .btn.telegram {
      background: #0088CC;
      color: var(--card-bg);
    }
    .btn.telegram:hover {
      background: #00A1E6;
      transform: scale(1.01);
    }
    .error {
      color: var(--danger);
      font-size: 0.8rem; /* Smaller font */
      margin-top: 8px; /* Reduced margin */
    }
    .loading {
      color: var(--accent-primary);
      font-size: 0.8rem;
      margin-top: 8px;
      display: none;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .loading-spinner {
      border: 2px solid rgba(var(--accent-primary-rgb), 0.3); /* Smaller spinner */
      border-top: 2px solid var(--accent-primary);
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    /* Main Page Styles - Compact */
    .main-app {
      font-family: "El Messiri", sans-serif;
      background-color: var(--bg-light);
      padding: 1rem 0.5rem 80px 0.5rem; /* Reduced padding */
      display: none;
      flex-direction: column;
      align-items: center;
      width: 100%;
      min-height: 100vh;
      transition: all 0.3s ease;
    }
    header {
      text-align: center;
      margin-bottom: 1.5rem; /* Reduced margin */
      animation: fadeInDown 0.8s ease-out;
    }
    .main-title {
      font-size: 2.5rem; /* Smaller title */
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: 2px; /* Tighter spacing */
    }
    .main-title span {
      color: var(--accent-primary);
      font-weight: 700;
    }
    .subtitle {
      color: var(--text-secondary);
      font-size: 0.9rem; /* Smaller subtitle */
      margin-top: 0.1rem;
      font-weight: 500;
    }
    main {
      flex-grow: 1;
      max-width: 500px; /* Slightly narrower */
      width: 100%;
      z-index: 10;
    }
    .card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 0.75rem; /* Smaller radius */
      box-shadow: 0 3px 15px var(--shadow-color); /* Reduced shadow */
      transition: all 0.3s ease;
      animation: fadeInUp 0.8s ease-out forwards;
      opacity: 0;
      padding: 1rem; /* Reduced padding */
    }
    .card:hover {
      transform: translateY(-3px); /* Milder lift */
      box-shadow: 0 5px 20px var(--shadow-color-hover);
    }
    nav {
      position: fixed;
      bottom: 0;
      left: 0;
      transform: none;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border-color);
      border-radius: 0;
      display: flex;
      padding: 0.25rem; /* Reduced padding */
      width: 100%;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); /* Reduced shadow */
      z-index: 100;
      transition: all 0.3s ease;
      margin-bottom: 0;
    }
    body.dark-mode nav {
      background: rgba(30,41,59,0.85);
    }
    nav button {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--text-secondary);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.1rem; /* Tighter gap */
      flex-grow: 1;
      padding: 0.25rem 0; /* Reduced padding */
      border-radius: 0.75rem; /* Smaller radius */
      transition: all 0.3s ease;
      font-weight: 600;
      font-size: 0.8rem; /* Smaller text */
    }
    nav button:hover {
      color: var(--accent-primary);
    }
    nav button.active {
      color: var(--accent-primary);
      background-color: var(--accent-light);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .readout-box {
      background-color: var(--bg-light);
      border: 1px solid var(--border-color);
      border-radius: 0.5rem; /* Smaller radius */
      padding: 0.75rem; /* Reduced padding */
      text-align: center;
    }
    .readout-label {
      font-size: 0.8rem; /* Smaller label */
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 0.25rem; /* Reduced margin */
    }
    .readout-value {
      font-size: 1.5rem; /* Smaller value */
      font-weight: 700;
      letter-spacing: 1px;
      line-height: 1.1;
      color: var(--accent-primary);
    }
    .icon-win { color: var(--success); }
    .icon-loss { color: var(--danger); }
    .icon-pending { color: var(--accent-primary); animation: pulse-icon 2s infinite; }
    @keyframes pulse-icon {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }
    #historyContainer {
      max-height: 300px; /* Shorter container */
      overflow-y: auto;
    }
    .history-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem; /* Reduced padding */
      border-bottom: 1px solid #f1f1f1;
      transition: background-color 0.3s;
      color: var(--text-primary);
    }
    body.dark-mode .history-item {
      border-bottom-color: var(--border-color);
    }
    .history-item:last-child {
      border-bottom: none;
    }
    .signal-meter {
      height: 4px; /* Thinner meter */
      background: var(--border-color);
      border-radius: 2px;
      overflow: hidden;
      margin-top: 0.25rem;
    }
    .signal-fill {
      height: 100%;
      border-radius: 2px;
      background: linear-gradient(90deg, var(--accent-primary), var(--success));
      transition: width 1s ease-out;
    }
    .validity-box {
      background-color: var(--bg-light);
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      padding: 0.75rem;
      text-align: center;
      margin-top: 0.75rem;
    }
    .validity-value {
      font-size: 1rem; /* Smaller value */
      font-weight: 600;
      color: var(--text-primary);
    }
    /* Game Selection Styles - Compact */
    #tab-games .game-selection {
      position: relative;
      top: 0;
      left: 0;
      width: 100%;
      height: calc(100vh - 150px); /* Adjusted height */
      background: var(--bg-light);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 0.5rem; /* Reduced padding */
      z-index: 1;
      animation: fadeIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      overflow-y: auto;
      backdrop-filter: blur(10px);
    }
    #tab-games .game-selection-title {
      font-family: 'El Messiri', sans-serif;
      font-weight: 700;
      font-size: 1.8rem; /* Smaller title */
      margin: 0 0 1rem 0; /* Reduced margin */
      background: linear-gradient(45deg, var(--accent-primary), var(--accent-primary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: 2px;
      position: relative;
      display: inline-block;
      text-shadow: 0 0 10px var(--accent-light); /* Reduced glow */
      animation: glow 2s ease-in-out infinite alternate;
    }
    @keyframes glow {
      from { text-shadow: 0 0 5px var(--accent-light); }
      to { text-shadow: 0 0 10px var(--accent-primary), 0 0 15px var(--accent-light); }
    }
    #tab-games .game-list-container {
      width: 100%;
      max-width: 500px; /* Narrower */
      max-height: 100%;
      overflow-y: auto;
      padding: 0 5px; /* Reduced padding */
    }
    #tab-games .game-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); /* Adjusted columns */
      gap: 0.75rem; /* Tighter gap */
      padding: 0 5px 1rem; /* Reduced padding */
    }
    #tab-games .game-item {
      background: linear-gradient(145deg, var(--card-bg), rgba(var(--accent-primary-rgb), 0.05));
      border: 1px solid var(--accent-primary);
      border-radius: 12px; /* Smaller radius */
      padding: 1rem; /* Reduced padding */
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
      text-align: center;
      font-family: 'El Messiri', sans-serif;
      color: var(--text-primary);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* Reduced shadow */
      position: relative;
      overflow: hidden;
      opacity: 0.8;
    }
    #tab-games .game-item:hover {
      transform: translateY(-5px) scale(1.01); /* Milder transform */
      box-shadow: 0 10px 20px var(--accent-light);
      border-color: var(--accent-primary);
      opacity: 1;
    }
    #tab-games .game-name {
      font-size: 1.2rem; /* Smaller name */
      font-weight: 700;
      margin-bottom: 0.25rem; /* Reduced margin */
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    #tab-games .game-item:hover .game-name {
      color: var(--accent-primary);
      text-shadow: 0 0 5px var(--accent-light); /* Reduced shadow */
    }
    #tab-games .game-desc {
      font-size: 0.8rem; /* Smaller desc */
      color: var(--text-secondary);
      opacity: 0.7;
      transition: opacity 0.3s;
    }
    #tab-games .game-item:hover .game-desc {
      opacity: 1;
    }
    #tab-games .fullscreen-iframe {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      border: none;
      z-index: 1000;
      display: none;
      background: #000;
    }
    #tab-games .injector-tape {
      position: fixed;
      right: 1rem; /* Closer to edge */
      top: 50%;
      transform: translateY(-50%);
      width: 40px; /* Smaller button */
      height: 40px;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-primary));
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1001;
      box-shadow: 0 5px 15px var(--accent-light), inset 0 1px 2px rgba(255,255,255,0.2); /* Reduced shadow */
      border: 1px solid rgba(255, 255, 255, 0.3); /* Thinner border */
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
      color: white;
      font-size: 1rem; /* Smaller icon */
    }
    #tab-games .injector-tape:hover {
      transform: translateY(-50%) scale(1.02);
      box-shadow: 0 10px 20px var(--accent-light);
    }
    #tab-games .injector-tape::before {
      content: '\f053'; /* Back icon */
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
    }
    /* Settings Page Styles - Compact */
    .settings-section {
      display: flex;
      flex-direction: column;
      gap: 0.75rem; /* Tighter gap */
    }
    .settings-title {
      font-size: 1.2rem; /* Smaller title */
      font-weight: 700;
      color: var(--text-primary);
      text-align: center;
      margin-bottom: 0.75rem; /* Reduced margin */
    }
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 0.25rem; /* Tighter gap */
    }
    .input-group label {
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 0.8rem; /* Smaller label */
    }
    .input-group input {
      padding: 0.5rem; /* Reduced padding */
      border: 1px solid var(--border-color);
      border-radius: 0.375rem; /* Smaller radius */
      background: var(--card-bg);
      color: var(--text-primary);
      transition: border-color 0.3s;
    }
    .input-group input:focus {
      border-color: var(--accent-primary);
      outline: none;
    }
    .btn-group {
      display: flex;
      gap: 0.75rem; /* Tighter gap */
      margin-top: 0.75rem;
    }
    .btn-group .btn {
      flex: 1;
      width: auto;
    }
    .btn-overlay {
      position: relative;
      overflow: hidden;
    }
    .btn-overlay::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    .btn-overlay:hover::after {
      left: 100%;
    }
    .toggle-group {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.75rem;
      padding: 0.75rem; /* Reduced padding */
      background: var(--bg-light);
      border-radius: 0.5rem;
      border: 1px solid var(--border-color);
      color: var(--text-primary);
    }
    .toggle-switch {
      position: relative;
      width: 40px; /* Smaller toggle */
      height: 20px;
      background: var(--border-color);
      border-radius: 20px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .toggle-switch.active {
      background: var(--accent-primary);
    }
    .toggle-switch::before {
      content: '';
      position: absolute;
      top: 1px;
      left: 1px;
      width: 18px; /* Smaller knob */
      height: 18px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s;
    }
    .toggle-switch.active::before {
      transform: translateX(20px);
    }
    .theme-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); /* Smaller items */
      gap: 0.5rem; /* Tighter gap */
      margin-top: 0.75rem;
    }
    .theme-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      padding: 0.25rem; /* Reduced padding */
      border-radius: 0.375rem;
      transition: all 0.3s;
      border: 2px solid transparent;
    }
    .theme-item:hover {
      border-color: var(--accent-primary);
    }
    .theme-item.active {
      border-color: var(--accent-primary);
      background: var(--accent-light);
    }
    .theme-circle {
      width: 30px; /* Smaller circle */
      height: 30px;
      border-radius: 50%;
      margin-bottom: 0.25rem;
      border: 2px solid white;
      box-shadow: 0 1px 5px rgba(0,0,0,0.1); /* Reduced shadow */
    }
    .theme-name {
      font-size: 0.7rem; /* Smaller name */
      color: var(--text-secondary);
      text-align: center;
    }
    @media (max-width: 500px) {
      .login-box {
        padding: 16px; /* Further reduced */
      }
      .login-title {
        font-size: 1.8rem;
      }
      .form-input, .btn {
        font-size: 0.8rem;
      }
      .main-title {
        font-size: 2rem;
      }
      nav {
        width: 100%;
      }
      #tab-games .game-selection-title {
        font-size: 1.5rem;
      }
    }
    /* Dark mode overrides - Compact */
    body.dark-mode {
      --card-bg: #1e293b;
      --bg-light: #0f172a;
      --border-color: #334155;
      --text-primary: #f1f5f9;
      --text-secondary: #ffffff;
    }
    body.dark-mode .card {
      background: #1e293b;
      border-color: #334155;
    }
    body.dark-mode .readout-box,
    body.dark-mode .validity-box {
      background-color: #0f172a;
      border-color: #334155;
    }
    body.dark-mode nav {
      background: rgba(30,41,59,0.85);
      border-color: #334155;
    }
    body.dark-mode .history-item {
      border-bottom-color: #334155;
      color: var(--text-primary);
    }
    body.dark-mode .input-group input {
      background: #1e293b;
      color: var(--text-primary);
      border-color: #334155;
    }
    body.dark-mode #tab-games .game-item {
      background: linear-gradient(145deg, #1e293b, rgba(var(--accent-primary-rgb), 0.05));
      color: var(--text-primary);
    }
    body.dark-mode #tab-games .game-item .game-desc {
      color: var(--text-secondary);
    }
    body.dark-mode .login-title {
      text-shadow: 0 0 5px var(--accent-light); /* Reduced */
    }
    /* Animated Panda Logo Styles - Compact */
    .panda-container {
      width: 80px; /* Smaller */
      height: 80px;
      margin: 0 auto 12px; /* Reduced margin */
    }
    .panda-svg {
      width: 100%;
      height: 100%;
    }
    .ear-1, .mini-ear-1 {
      transform: translate(0%) rotate(45deg);
    }
    .ear-2, .mini-ear-2 {
      transform: translate(0%) rotate(-45deg);
    }
    .paw {
      animation-name: move-paw;
    }
    .paw-circle-1 {
      animation-name: move-circle-1;
    }
    .paw-circle-2 {
      animation-name: move-circle-2;
    }
    .paw-circle-3 {
      animation-name: move-circle-3;
    }
    .paw-circle-4 {
      animation-name: move-circle-4;
    }
    .paw-circle-5 {
      animation-name: move-circle-5;
    }
    .paw, .paw-circle-1, .paw-circle-2, .paw-circle-3, .paw-circle-4, .paw-circle-5 {
      animation-duration: 1s;
      animation-direction: alternate;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
    }
    @keyframes move-paw {
      from {
        transform: translateX(1%) translateY(1%) rotate(0deg);
      }
      to {
        transform: translateX(7%) translateY(-15%) rotate(10deg);
      }
    }
    @keyframes move-circle-1 {
      from {
        transform: translateX(1%) translateY(1%) rotate(0deg);
      }
      to {
        transform: translateX(7%) translateY(-15%) rotate(10deg);
      }
    }
    @keyframes move-circle-2 {
      from {
        transform: translateX(1%) translateY(1%) rotate(0deg);
      }
      to {
        transform: translateX(7%) translateY(-15%) rotate(10deg);
      }
    }
    @keyframes move-circle-3 {
      from {
        transform: translateX(1%) translateY(1%) rotate(0deg);
      }
      to {
        transform: translateX(7%) translateY(-15%) rotate(10deg);
      }
    }
    @keyframes move-circle-4 {
      from {
        transform: translateX(1%) translateY(1%) rotate(0deg);
      }
      to {
        transform: translateX(7%) translateY(-15%) rotate(10deg);
      }
    }
    @keyframes move-circle-5 {
      from {
        transform: translateX(1%) translateY(1%) rotate(0deg);
      }
      to {
        transform: translateX(7%) translateY(-15%) rotate(10deg);
      }
    }
    /* Pattern Display - Added for showing patterns */
    .pattern-display {
      background: var(--bg-light);
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      padding: 0.75rem;
      margin-top: 0.5rem;
      font-size: 0.8rem;
      color: var(--text-secondary);
      text-align: left;
      max-height: 200px;
      overflow-y: auto;
    }
    .pattern-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.25rem;
      padding: 0.25rem;
      border-radius: 0.25rem;
      background: rgba(var(--accent-primary-rgb), 0.05);
    }
    .pattern-name { font-weight: 600; color: var(--text-primary); }
    .pattern-pred { color: var(--accent-primary); font-weight: bold; }
  </style>
</head>
<body oncontextmenu="return false;" class="light-mode theme-default">
  <div id="loginSection" class="login-container">
    <div class="login-box">
      <div class="panda-container">
        <svg class="panda-svg" viewBox="-50 0 270 150">
          <g fill="#4a4a4a">
            <ellipse class="ear-1" rx="20" ry="25" cx="42" cy="7"></ellipse>
            <ellipse class="ear-2" rx="20" ry="25" cx="71" cy="120"></ellipse>
          </g>
          <g fill="#010101">
            <ellipse class="mini-ear-1" rx="7" ry="10" cx="42" cy="7"></ellipse>
            <ellipse class="mini-ear-2" rx="7" ry="10" cx="71" cy="120"></ellipse>
          </g>
          <circle r="70" cx="80" cy="80" fill="#ffffff"></circle>
          <ellipse rx="10" ry="7" cx="80" cy="102" fill="#010101"></ellipse>
          <g fill="#4a4a4a">
            <ellipse rx="15" ry="19" cx="46" cy="84"></ellipse>
            <ellipse rx="15" ry="19" cx="111" cy="84"></ellipse>
          </g>
          <g fill="#010101">
            <circle r="7" cx="46" cy="79"></circle>
            <circle r="7" cx="111" cy="79"></circle>
          </g>
          <g fill="#ffffff">
            <circle r="3" cx="43" cy="78"></circle>
            <circle r="3" cx="109" cy="78"></circle>
          </g>
          <ellipse class="paw" fill="#4a4a4a" rx="20" ry="25" cx="150" cy="120"></ellipse>
          <g fill="#ffffff">
            <circle class="paw-circle-1" r="4" cx="137" cy="118"></circle>
            <circle class="paw-circle-2" r="4" cx="163" cy="118"></circle>
            <circle class="paw-circle-3" r="5" cx="143" cy="108"></circle>
            <circle class="paw-circle-4" r="5" cx="157" cy="108"></circle>
            <ellipse class="paw-circle-5" rx="10" ry="8" cx="150" cy="127"></ellipse>
          </g>
          <line x1="0" y1="150" x2="150" y2="150" stroke="#dde9af" stroke-width="20"></line>
          <g stroke="green" stroke-width="2">
            <line x1="15" y1="160" x2="15" y2="140"></line>
            <line x1="45" y1="160" x2="45" y2="140"></line>
            <line x1="75" y1="160" x2="75" y2="140"></line>
            <line x1="105" y1="160" x2="105" y2="140"></line>
            <line x1="135" y1="160" x2="135" y2="140"></line>
            <line x1="70" y1="142" x2="40" y2="130"></line>
          </g>
          <g fill="green">
            <polygon points="45, 120 50, 130 60, 137"></polygon>
            <polygon points="50, 139 55, 135 37, 140"></polygon>
          </g>
          <ellipse fill="#4a4a4a" rx="25" ry="20" cx="10" cy="150"></ellipse>
        </svg>
      </div>
      <div class="login-title">RAJA GAME AI</div>
      <input type="text" id="accessKey" placeholder="Enter Access Key" class="form-input">
      <button id="loginButton" class="btn btn-primary">Login</button>
      <button class="btn telegram" onclick="window.open('https://t.me/+5GjlzeLC-ThjMWU1', '_blank')">
        <i class="fab fa-telegram-plane"></i> Get Key
      </button>
      <div class="loading" id="loading">Verifying...<div class="loading-spinner"></div></div>
      <div class="error" id="error"></div>
    </div>
  </div>
  <div id="mainApp" class="main-app">
    <header>
      <h1 class="main-title">RAJA GAME AI</h1>
      <p class="subtitle">by <span>krish</span></p>
    </header>
    <main>
      <section id="tab-games" class="tab-content w-full">
        <div class="game-selection" id="gameSelection">
          <h1 class="game-selection-title">SELECT GAME</h1>
          <div class="game-list-container">
            <div class="game-list">
              <div class="game-item" data-url="https://www.rajaparty7.com/#/" role="button" tabindex="0">
                <div class="game-name">RAJA GAME</div>
                <div class="game-desc">Enter the arena of big wins</div>
              </div>
              <div class="game-item" data-url="http://Okwin.bio" role="button" tabindex="0">
                <div class="game-name">OK WIN</div>
                <div class="game-desc">Unlock your fortune now</div>
              </div>
              <div class="game-item" data-url="https://goagamea.com/#/login" role="button" tabindex="0">
                <div class="game-name">GOA GAME</div>
                <div class="game-desc">Goa vibes, massive payouts</div>
              </div>
              <div class="game-item" data-url="https://www.bigmumbaiq.com/#/login" role="button" tabindex="0">
                <div class="game-name">BIG MUMBAI</div>
                <div class="game-desc">Mumbai's biggest bets</div>
              </div>
              <div class="game-item" data-url="http://tirangagame.top" role="button" tabindex="0">
                <div class="game-name">TIRANGA</div>
                <div class="game-desc">Patriotic wins await</div>
              </div>
              <div class="game-item" data-url="https://51game5.com/#/" role="button" tabindex="0">
                <div class="game-name">51 GAME</div>
                <div class="game-desc">51 ways to victory</div>
              </div>
              <div class="game-item" data-url="https://bdgwin.cc/#/login" role="button" tabindex="0">
                <div class="game-name">BDG WIN</div>
                <div class="game-desc">BDG's winning edge</div>
              </div>
              <div class="game-item" data-url="http://rajawager.com" role="button" tabindex="0">
                <div class="game-name">RAJA WAGER</div>
                <div class="game-desc">Royal wagers, royal rewards</div>
              </div>
              <div class="game-item" data-url="http://55club.game" role="button" tabindex="0">
                <div class="game-name">55 CLUB</div>
                <div class="game-desc">Club exclusive jackpots</div>
              </div>
              <div class="game-item" data-url="https://bharatclub.net/#/login" role="button" tabindex="0">
                <div class="game-name">BHARAT CLUB</div>
                <div class="game-desc">Bharat's elite gaming</div>
              </div>
              <div class="game-item" data-url="https://www.DamanWorld.Asia/#/" role="button" tabindex="0">
                <div class="game-name">DAMAN</div>
                <div class="game-desc">Daman's daring draws</div>
              </div>
              <div class="game-item" data-url="https://www.aatclub.com/#/" role="button" tabindex="0">
                <div class="game-name">91 CLUB</div>
                <div class="game-desc">91 levels of thrill</div>
              </div>
            </div>
          </div>
        </div>
        <iframe id="gameFrame" class="fullscreen-iframe" allowfullscreen aria-label="Game Window"></iframe>
        <button class="injector-tape" id="injectorTape" aria-label="Back to Game Selection"></button>
      </section>
      <section id="tab-home" class="tab-content active w-full space-y-4"> <!-- Tighter space-y -->
        <div class="card p-3"> <!-- Reduced p-3 -->
          <div class="grid grid-cols-2 gap-2"> <!-- Tighter gap -->
            <div class="readout-box">
              <h2 class="readout-label">Period</h2>
              <div id="periodDisplay" class="readout-value">---</div>
            </div>
            <div class="readout-box">
              <h2 class="readout-label">Prediction</h2>
              <div id="predictionDisplay" class="readout-value text-gray-500">...</div>
            </div>
          </div>
          <div class="mt-2 border-t border-gray-200 pt-2"> <!-- Tighter mt/pt -->
            <div class="flex justify-between items-center mb-1">
              <p class="text-xs font-semibold text-secondary">Confidence</p> <!-- Smaller text -->
              <p id="signalStrengthDisplay" class="font-bold text-xs">Calculating...</p>
            </div>
            <div class="signal-meter">
              <div id="signalStrengthBar" class="signal-fill" style="width: 0%"></div>
            </div>
          </div>
          <!-- Added Pattern Display -->
          <div class="pattern-display" id="patternDisplay">
            <div class="text-xs text-secondary">No patterns analyzed yet.</div>
          </div>
        </div>
        <div class="card p-3 w-full"> <!-- Reduced p-3 -->
          <h3 class="font-bold text-base mb-1">System Status</h3> <!-- Smaller text, tighter mb -->
          <div class="space-y-2"> <!-- Tighter space-y -->
            <div class="flex justify-between items-center text-xs"> <!-- Smaller text -->
              <p class="text-secondary">API Connection:</p>
              <p class="font-bold flex items-center gap-1" id="apiStatus"> <!-- Tighter gap -->
                <i class="fa-solid fa-circle-check text-green-500"></i> Active
              </p>
            </div>
            <div class="flex justify-between items-center text-xs">
              <p class="text-secondary">Last Update:</p>
              <p class="font-bold" id="lastUpdateTime">Just now</p>
            </div>
          </div>
        </div>
      </section>
      <section id="tab-history" class="tab-content w-full">
        <div class="card p-2 sm:p-3"> <!-- Reduced padding -->
          <div class="flex justify-between items-center mb-1 p-2"> <!-- Tighter mb/p -->
            <h3 class="text-lg font-bold text-gray-700">History</h3> <!-- Smaller text -->
            <button id="clearHistoryBtn" class="bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center shadow-md hover:bg-red-600 transition"> <!-- Smaller button -->
              <i class="fa-solid fa-trash"></i>
            </button>
          </div>
          <div id="historyContainer">
            <div class="text-center py-4 text-secondary"> <!-- Reduced py -->
              <i class="fa-solid fa-inbox mb-1 text-2xl"></i> <!-- Smaller icon -->
              <p>No history yet.</p>
            </div>
          </div>
        </div>
      </section>
      <section id="tab-settings" class="tab-content w-full">
        <div class="card p-4 w-full space-y-3"> <!-- Reduced p-4, space-y-3 -->
          <h3 class="settings-title">Telegram Prediction</h3>
          <button id="saveSettingsBtn" class="btn btn-primary">Save</button>
          <div class="input-group">
            <label for="botToken">Bot Token</label>
            <input type="text" id="botToken" placeholder="Enter bot token">
          </div>
          <div class="input-group">
            <label for="chatId">Chat ID</label>
            <input type="text" id="chatId" placeholder="Enter chat ID">
          </div>
          <div class="btn-group">
            <button class="btn btn-primary btn-overlay" id="startAutoBtn">Start Auto</button>
          </div>
          <div class="toggle-group">
            <span>Dark/Light Mode</span>
            <div class="toggle-switch" id="modeToggle"></div>
          </div>
          <div class="theme-grid">
            <div class="theme-item active" data-theme="default">
              <div class="theme-circle" style="background: #007BFF;"></div>
              <div class="theme-name">Default</div>
            </div>
            <div class="theme-item" data-theme="neon">
              <div class="theme-circle" style="background: #FF00FF;"></div>
              <div class="theme-name">Neon</div>
            </div>
            <div class="theme-item" data-theme="gold">
              <div class="theme-circle" style="background: #FFD700;"></div>
              <div class="theme-name">Gold</div>
            </div>
            <div class="theme-item" data-theme="green">
              <div class="theme-circle" style="background: #28A745;"></div>
              <div class="theme-name">Green</div>
            </div>
            <div class="theme-item" data-theme="purple">
              <div class="theme-circle" style="background: #6F42C1;"></div>
              <div class="theme-name">Purple</div>
            </div>
            <div class="theme-item" data-theme="red">
              <div class="theme-circle" style="background: #DC3545;"></div>
              <div class="theme-name">Red</div>
            </div>
          </div>
          <a href="https://t.me/+5GjlzeLC-ThjMWU1" target="_blank" class="btn btn-primary w-full">
            <i class="fab fa-telegram"></i> Join Telegram
          </a>
        </div>
      </section>
      <section id="tab-info" class="tab-content w-full">
        <div class="card p-4 w-full text-center space-y-3"> <!-- Reduced p-4, space-y-3 -->
          <div>
            <h4 class="text-base font-semibold">RAJA GAME AI</h4> <!-- Smaller text -->
            <p class="text-xs text-secondary">by krish</p>
          </div>
          <p class="text-xs text-gray-500 px-2">This tool uses an advanced, multi-logic engine for predictions. Performance is not guaranteed. Use responsibly.</p> <!-- Reduced px -->
          <a href="https://t.me/+5GjlzeLC-ThjMWU1" target="_blank" class="btn btn-primary w-full">
            <i class="fa-brands fa-telegram"></i> Contact Developer
          </a>
          <button id="logoutButton" class="btn btn-primary w-full">
            <i class="fa-solid fa-sign-out-alt"></i> Logout
          </button>
          <div class="validity-box">
            <h2 class="readout-label">Key Validity</h2>
            <div id="validityDisplay" class="validity-value">Checking...</div>
          </div>
        </div>
      </section>
    </main>
    <nav>
      <button class="tab-btn active" data-tab="games"><i class="fa-solid fa-gamepad fa-lg"></i><span class="text-xs">Games</span></button>
      <button class="tab-btn" data-tab="home"><i class="fa-solid fa-house fa-lg"></i><span class="text-xs">Home</span></button>
      <button class="tab-btn" data-tab="history"><i class="fa-solid fa-list-check fa-lg"></i><span class="text-xs">History</span></button>
      <button class="tab-btn" data-tab="settings"><i class="fa-solid fa-gear fa-lg"></i><span class="text-xs">Settings</span></button>
      <button class="tab-btn" data-tab="info"><i class="fa-solid fa-info-circle fa-lg"></i><span class="text-xs">Info</span></button>
    </nav>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getDatabase, ref, get, update, onValue } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
    const firebaseConfig = {
      apiKey: "AIzaSyD7W66vnvef_p_Qs8CJ7_ucjHegrT4-iRQ",
      authDomain: "masstamil-fa915.firebaseapp.com",
      databaseURL: "https://masstamil-fa915-default-rtdb.firebaseio.com",
      projectId: "masstamil-fa915",
      storageBucket: "masstamil-fa915.firebasestorage.app",
      messagingSenderId: "493712872366",
      appId: "1:493712872366:web:48133eb51bd415c4ad6e3f",
      measurementId: "G-8S7CLWQRYB"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    // Telegram Constants
    const START_MSG = '\n    As B S\n';
    const STOP_MSG = '\n    As B S \n';
    // STICKERS
    const STICKERS = {
      start: 'CAACAgUAAxkBAAEPycNpGUSkOWo_kwNBrJWcZHhqRMhgIgACwhIAAve54VX0PIIyOPYl4jYE', 
      win: 'CAACAgUAAxkBAAEP9wZpN6Gwg0-zR0MQlAGT-gScYHI2gQACwhIAAp5MYVVFF8quYcNqBTYE',
      stop: 'CAACAgUAAxkBAAEPycVpGUSohp9_1Q-dsbF4zYJwyWjnoQACZRQAAp8S4VXPEAABFoY2uWQ2BA'
    };
    // Fixed Telegram Send Functions
    async function sendTelegramMessage(token, chatId, text) {
      try {
        const url = `https://api.telegram.org/bot${token}/sendMessage`;
        const params = new URLSearchParams();
        params.append('chat_id', chatId);
        params.append('text', text);
        const res = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: params
        });
        if (!res.ok) {
          const errorData = await res.json().catch(() => ({}));
          throw new Error(`HTTP ${res.status}: ${errorData.description || 'Unknown error'}`);
        }
        console.log('Message sent successfully');
      } catch (e) {
        console.error('Telegram sendMessage error:', e);
      }
    }
    async function sendTelegramSticker(token, chatId, stickerId) {
      if (!stickerId) {
        console.warn('Sticker ID is missing; skipping sticker send.');
        return;
      }
      try {
        const url = `https://api.telegram.org/bot${token}/sendSticker`;
        const params = new URLSearchParams();
        params.append('chat_id', chatId);
        params.append('sticker', stickerId);
        const res = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: params
        });
        if (!res.ok) {
          const errorData = await res.json().catch(() => ({}));
          throw new Error(`HTTP ${res.status}: ${errorData.description || 'Unknown error'}`);
        }
        console.log('Sticker sent successfully');
      } catch (e) {
        console.error('Telegram sendSticker error:', e);
      }
    }
    // Allow text input in accessKey field
    document.getElementById('accessKey').addEventListener('keydown', (event) => {
      const allowedKeys = [
        'Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown',
        'Tab', 'Enter', 'Home', 'End'
      ];
      if (allowedKeys.includes(event.key) ||
          (!event.ctrlKey && !event.altKey && !event.metaKey && event.key.length === 1)) {
        return true;
      }
      event.preventDefault();
    });
    // Theme Management
    function applyTheme(themeName) {
      document.body.className = document.body.className.replace(/theme-\w+/g, '').trim();
      document.body.classList.add(`theme-${themeName}`);
      localStorage.setItem('selectedTheme', themeName);
      const rgbMap = {
        default: '0,123,255',
        neon: '255,0,255',
        gold: '255,215,0',
        green: '40,167,69',
        purple: '111,66,193',
        red: '220,53,69'
      };
      document.body.style.setProperty('--accent-primary-rgb', rgbMap[themeName]);
    }
    function loadTheme() {
      const savedTheme = localStorage.getItem('selectedTheme') || 'default';
      applyTheme(savedTheme);
      document.querySelector(`[data-theme="${savedTheme}"]`).classList.add('active');
    }
    // Login Logic
    function getDeviceId() {
      let id = localStorage.getItem("device_id");
      if (!id) {
        id = crypto.randomUUID();
        localStorage.setItem("device_id", id);
      }
      return id;
    }
    async function handleLogin() {
      const key = document.getElementById("accessKey").value.trim();
      const errorDiv = document.getElementById("error");
      const loadingDiv = document.getElementById("loading");
      const deviceId = getDeviceId();
      errorDiv.innerText = "";
      loadingDiv.style.display = "flex";
      if (!key) {
        loadingDiv.style.display = "none";
        errorDiv.innerText = "Please enter an access key.";
        return;
      }
      try {
        const snap = await get(ref(db, `accessKeys/${key}`));
        loadingDiv.style.display = "none";
        if (!snap.exists()) {
          errorDiv.innerText = "Invalid access key.";
          return;
        }
        const data = snap.val();
        if (!data.active) {
          errorDiv.innerText = "Access key is deactivated.";
          return;
        }
        const now = Date.now();
        if (data.expiry && now > data.expiry) {
          errorDiv.innerText = "Access key has expired.";
          return;
        }
        if (data.deviceId && data.deviceId !== deviceId) {
          errorDiv.innerText = "This key is already used on another device.";
          return;
        }
        if (!data.deviceId) {
          await update(ref(db, `accessKeys/${key}`), { deviceId });
        }
        localStorage.setItem("access_key", key);
        localStorage.setItem('loginTimestamp', Date.now());
        showMainApp();
        listenForKeyStatus(key);
        updateValidityDisplay(key);
      } catch (err) {
        loadingDiv.style.display = "none";
        errorDiv.innerText = "Login failed. Check your connection or try again.";
        console.error("Login Error:", err);
      }
    }
    function showMainApp() {
      const loginSection = document.getElementById('loginSection');
      const mainApp = document.getElementById('mainApp');
      loginSection.style.transition = 'opacity 0.3s ease';
      loginSection.style.opacity = '0';
      setTimeout(() => {
        loginSection.style.display = 'none';
        mainApp.style.display = 'flex';
        mainApp.style.transition = 'opacity 0.3s ease';
        mainApp.style.opacity = '0';
        setTimeout(() => {
          mainApp.style.opacity = '1';
          init();
          initGames();
          initSettings();
        }, 50);
      }, 300);
    }
    function logout() {
      const loginSection = document.getElementById('loginSection');
      const mainApp = document.getElementById('mainApp');
      mainApp.style.transition = 'opacity 0.3s ease';
      mainApp.style.opacity = '0';
      setTimeout(() => {
        mainApp.style.display = 'none';
        loginSection.style.display = 'flex';
        loginSection.style.transition = 'opacity 0.3s ease';
        loginSection.style.opacity = '0';
        setTimeout(() => {
          loginSection.style.opacity = '1';
          document.getElementById('accessKey').value = '';
          document.getElementById('error').innerText = '';
        }, 50);
      }, 300);
      localStorage.removeItem("access_key");
      localStorage.removeItem('loginTimestamp');
      if (isAutoRunning) stopAuto();
    }
    function listenForKeyStatus(key) {
      const keyRef = ref(db, `accessKeys/${key}`);
      onValue(keyRef, (snapshot) => {
        if (!snapshot.exists()) {
          console.log(`Key ${key} deleted from Firebase`);
          logout();
          document.getElementById('error').innerText = "Access key was deleted.";
        } else {
          const data = snapshot.val();
          if (!data.active) {
            console.log(`Key ${key} deactivated`);
            logout();
            document.getElementById('error').innerText = "Access key was deactivated.";
          }
        }
      }, (error) => {
        console.error("Key Listener Error:", error);
        logout();
        document.getElementById('error').innerText = "Session error. Please log in again.";
      });
    }
    function updateValidityDisplay(key) {
      const validityDisplay = document.getElementById('validityDisplay');
      const keyRef = ref(db, `accessKeys/${key}`);
      get(keyRef).then((snapshot) => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          if (!data.expiry) {
            validityDisplay.textContent = 'Permanent';
            return;
          }
          updateRemainingTime(data.expiry);
        }
      });
      const intervalId = setInterval(() => {
        get(keyRef).then((snapshot) => {
          if (snapshot.exists()) {
            const data = snapshot.val();
            if (!data.expiry) {
              validityDisplay.textContent = 'Permanent';
            } else {
              updateRemainingTime(data.expiry);
            }
          } else {
            clearInterval(intervalId);
            logout();
            document.getElementById('error').innerText = "Access key was deleted.";
          }
        });
      }, 1000);
      function updateRemainingTime(expiry) {
        const now = Date.now();
        const diffMs = expiry - now;
        if (diffMs <= 0) {
          validityDisplay.textContent = 'Expired';
          clearInterval(intervalId);
          logout();
          document.getElementById('error').innerText = "Access key has expired.";
          return;
        }
        const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diffMs % (1000 * 60)) / 1000);
        let validityText = '';
        if (days > 0) {
          validityText = `${days}d ${hours}h ${minutes}m ${seconds}s`;
        } else if (hours > 0) {
          validityText = `${hours}h ${minutes}m ${seconds}s`;
        } else if (minutes > 0) {
          validityText = `${minutes}m ${seconds}s`;
        } else {
          validityText = `${seconds}s`;
        }
        validityDisplay.textContent = validityText;
      }
    }
    function checkAutoLogout() {
      const loginTimestamp = localStorage.getItem('loginTimestamp');
      if (loginTimestamp) {
        const now = Date.now();
        const hoursPassed = (now - loginTimestamp) / (1000 * 60 * 60);
        if (hoursPassed > 12) {
          logout();
          document.getElementById('error').innerText = "Session expired. Please log in again.";
        }
      }
    }
    document.getElementById("loginButton").addEventListener("click", handleLogin);
    document.getElementById("logoutButton").addEventListener("click", logout);
    window.addEventListener('DOMContentLoaded', () => {
      loadTheme();
      const body = document.body;
      const isDark = localStorage.getItem('darkMode') === 'true';
      if (isDark) {
        body.classList.remove('light-mode');
        body.classList.add('dark-mode');
      }
      const savedKey = localStorage.getItem("access_key");
      document.getElementById('loginSection').style.display = 'flex';
      document.getElementById('mainApp').style.display = 'none';
      if (savedKey) {
        document.getElementById("accessKey").value = savedKey;
        checkAutoLogout();
        handleLogin();
      } else {
        getDeviceId();
        document.getElementById('loginSection').style.opacity = '1';
      }
    });
    // KRISH AI Logic (Enhanced Prediction - Collapsed Methods)
    let predictionHistory = [];
    let lastCheckedPeriod = null;
    let currentPrediction = null;
    let autoInterval = null;
    let isAutoRunning = false;
    const SKIP_THRESHOLD = 60;
    const ui = {
      period: document.getElementById('periodDisplay'),
      prediction: document.getElementById('predictionDisplay'),
      history: document.getElementById('historyContainer'),
      apiStatus: document.getElementById('apiStatus'),
      lastUpdate: document.getElementById('lastUpdateTime'),
      signalDisplay: document.getElementById('signalStrengthDisplay'),
      signalBar: document.getElementById('signalStrengthBar'),
      clearBtn: document.getElementById('clearHistoryBtn'),
      patternDisplay: document.getElementById('patternDisplay'),
      tabs: document.querySelectorAll('.tab-btn'),
      contents: document.querySelectorAll('.tab-content')
    };
    ui.tabs.forEach(button => {
      button.addEventListener('click', () => {
        const tabId = button.getAttribute('data-tab');
        ui.tabs.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        ui.contents.forEach(content => {
          content.classList.remove('active');
          content.style.display = 'none';
        });
        const activeTab = document.getElementById(`tab-${tabId}`);
        activeTab.classList.add('active');
        activeTab.style.display = 'block';
        activeTab.querySelectorAll('.card').forEach((card, index) => {
          card.style.animation = 'none';
          void card.offsetWidth;
          card.style.animation = `fadeInUp 0.6s ease-out ${index * 0.1}s forwards`;
        });
      });
    });
    ui.clearBtn.addEventListener('click', () => {
      if (confirm('Clear prediction history?')) {
        predictionHistory = [];
        updateHistoryDisplay();
      }
    });
    const API_URL = 'https://draw.ar-lottery01.com/WinGo/WinGo_1M/GetHistoryIssuePage.json';
    async function fetchHistory() {
      try {
        const response = await fetch(`${API_URL}?t=${new Date().getTime()}`, { cache: 'no-store' });
        if (!response.ok) throw new Error('Network response failed');
        const data = await response.json();
        if (!data || !data.data || !data.data.list) throw new Error('Invalid API data structure');
        ui.apiStatus.innerHTML = `<i class="fa-solid fa-circle-check text-green-500"></i> Active`;
        processApiData(data.data.list);
      } catch (error) {
        console.error("Fetch Error:", error);
        ui.apiStatus.innerHTML = `<i class="fa-solid fa-circle-xmark text-red-500"></i> Error`;
      }
    }
    function processApiData(results) {
      const latest = results[0];
      if (latest && latest.issueNumber !== lastCheckedPeriod) {
        lastCheckedPeriod = latest.issueNumber;
        updatePredictionStatuses(results);
        const nextPeriod = (BigInt(latest.issueNumber) + 1n).toString();
        const { prediction, confidence, patterns } = krishAIPredictionEngine(results); // Collapsed engine with patterns
        if (!predictionHistory.some(p => p.period === nextPeriod)) {
          predictionHistory.unshift({ period: nextPeriod, prediction, status: 'pending', sentToTelegram: false, stickerSent: false, patterns, confidence });
        }
        if (predictionHistory.length > 50) predictionHistory.pop();
        currentPrediction = { period: nextPeriod, prediction };
        updateUI(nextPeriod, prediction, confidence, patterns);
      }
      ui.lastUpdate.textContent = new Date().toLocaleTimeString();
    }
    function updatePredictionStatuses(results) {
      predictionHistory.forEach(p => {
        if (p.status === 'pending') {
          const result = results.find(r => r.issueNumber === p.period);
          if (result) {
            const number = parseInt(result.number, 10);
            let actual;
            if (number === 0 || number === 5) {
              actual = (number === 5) ? 'BIG' : 'SMALL';
            } else {
              actual = number >= 5 ? 'BIG' : 'SMALL';
            }
            p.actual = actual;
            if (p.prediction === 'SKIP') {
              p.status = 'skip';
            } else {
              const oldStatus = p.status;
              p.status = (p.prediction.toLowerCase() === actual.toLowerCase()) ? 'win' : 'loss';
              if (oldStatus === 'pending' && p.sentToTelegram && !p.stickerSent && p.status === 'win') {
                const botToken = localStorage.getItem('botToken');
                const chatId = localStorage.getItem('chatId');
                if (botToken && chatId) {
                  const stickerId = STICKERS.win;
                  sendTelegramSticker(botToken, chatId, stickerId);
                  p.stickerSent = true;
                }
              }
            }
          }
        }
      });
    }
    function updateUI(nextPeriod, prediction, confidence, patterns) {
      ui.period.textContent = nextPeriod.slice(-4);
      ui.prediction.textContent = prediction === 'SKIP' ? 'SKIP' : prediction.toUpperCase();
      ui.prediction.style.color = prediction === 'SKIP' ? 'var(--text-secondary)' : prediction === 'BIG' ? 'var(--success)' : 'var(--danger)';
      ui.signalDisplay.textContent = prediction === 'SKIP' ? 'Skipped' : `${confidence.toFixed(1)}%`;
      ui.signalBar.style.width = prediction === 'SKIP' ? '0%' : `${confidence}%`;
      updateHistoryDisplay();
      // Update pattern display
      updatePatternDisplay(patterns);
    }
    function updatePatternDisplay(patterns) {
      if (!patterns || patterns.length === 0) {
        ui.patternDisplay.innerHTML = '<div class="text-xs text-secondary">No patterns analyzed yet.</div>';
        return;
      }
      ui.patternDisplay.innerHTML = patterns.map(p => `
        <div class="pattern-item">
          <span class="pattern-name">${p.name}</span>
          <span class="pattern-pred">${p.pred}</span>
        </div>
      `).join('');
    }
    function updateHistoryDisplay() {
      if (predictionHistory.length === 0) {
        ui.history.innerHTML = `<div class="text-center py-4 text-secondary"><i class="fa-solid fa-inbox mb-1 text-2xl"></i><p>No history yet.</p></div>`;
        return;
      }
      const wins = predictionHistory.filter(h => h.status === 'win').length;
      const losses = predictionHistory.filter(h => h.status === 'loss').length;
      const skips = predictionHistory.filter(h => h.status === 'skip').length;
      ui.history.innerHTML = `
        <div class="flex justify-around items-center mb-2 p-2" style="background: var(--bg-light); border-radius: 0.5rem; border: 1px solid var(--border-color);">
          <span class="font-bold text-sm" style="color: var(--success);">Wins: ${wins}</span>
          <span class="font-bold text-sm" style="color: var(--danger);">Losses: ${losses}</span>
          <span class="font-bold text-sm" style="color: var(--text-secondary);">Skips: ${skips}</span>
        </div>
        ${predictionHistory.slice(0, 20).map(item => {
          let iconClass = item.status === 'win' ? 'icon-win fa-trophy' :
                          item.status === 'loss' ? 'icon-loss fa-shield-halved' :
                          item.status === 'skip' ? 'fa-ban' :
                          'icon-pending fa-clock';
          let iconHtml = `<i class="fa-solid ${iconClass} text-lg w-5 text-center"></i>`;
          if (item.status === 'skip') {
            iconHtml = `<i class="fa-solid fa-ban text-gray-500 text-lg w-5 text-center"></i>`;
          }
          const predColor = item.status === 'win' ? 'var(--success)' :
                            item.status === 'loss' ? 'var(--danger)' :
                            item.status === 'skip' ? 'var(--text-secondary)' :
                            'var(--accent-primary)';
          return `
            <div class="history-item">
              <div class="flex items-center gap-2">
                ${iconHtml}
                <div>
                  <p class="font-bold text-sm">Period ${item.period.slice(-4)}</p>
                  <p class="text-xs text-secondary">
                    Actual: ${item.actual ? item.actual.toUpperCase() : '---'}
                  </p>
                </div>
              </div>
              <div class="font-bold text-xs" style="color: ${predColor};">${item.prediction.toUpperCase()}</div>
            </div>`;
        }).join('')}
      `;
    }
    async function sendPrediction(token, chatId) {
      if (!currentPrediction) {
        console.warn('No prediction available. Wait for the next update.');
        return;
      }
      const { period, prediction } = currentPrediction;
      const predObj = predictionHistory.find(p => p.period === period);
      if (predObj && predObj.sentToTelegram) {
        console.log('Prediction already sent for this period.');
        return;
      }
      const periodNo = period.slice(-5);
      let msg;
      if (prediction === 'SKIP') {
        msg = `

W :  M
P N : ${periodNo}
 [  ] 
  '  

      `;
      } else {
        const predText = prediction.toUpperCase() === 'BIG' ? 'B' : 'S';
        msg = `

W :  M
 M  L
P N : ${periodNo}
 P 
 [ ${predText} ]

      `;
      }
      await sendTelegramMessage(token, chatId, msg);
      if (predObj) {
        predObj.sentToTelegram = true;
      }
    }
    function stopAuto() {
      if (autoInterval) clearInterval(autoInterval);
      autoInterval = null;
      isAutoRunning = false;
      const autoBtn = document.getElementById('startAutoBtn');
      autoBtn.textContent = 'Start Auto';
      autoBtn.classList.remove('running');
      const botToken = localStorage.getItem('botToken');
      const chatId = localStorage.getItem('chatId');
      if (botToken && chatId) {
        const stopStickerId = STICKERS.stop;
        if (stopStickerId) sendTelegramSticker(botToken, chatId, stopStickerId);
        sendTelegramMessage(botToken, chatId, STOP_MSG);
      }
    }
    function init() {
      fetchHistory();
      setInterval(fetchHistory, 4000);
      updateHistoryDisplay();
    }
    // Collapsed KRISH AI Prediction Engine (Merged into 2 Main Methods: Trend-Based & Statistical)
    const krishAIPredictionEngine = (history) => {
      const classify = (num) => parseInt(num, 10) >= 5 ? 'BIG' : 'SMALL';
      const bigSmallHistory = history.map(h => classify(h.number));
      const numbers = history.map(h => parseInt(h.number, 10));
      const issues = history.map(h => h.issueNumber);
      // Collapsed Strategies: Grouped into 2 methods
      const trendBased = []; // Trend, reversal, frequency, alternating, duoStreak, trioFlip, sequenceGap, cycleDetector, breakoutPattern
      const statistical = []; // Moving avg, volatility, RSI-like, Bollinger-like, momentum, weighted recent, harmonic mean, entropy, consensus
      // Trend-Based Method (Weight: 0.6 total)
      const recentTrend = bigSmallHistory.slice(0, 10);
      const bigTrendCount = recentTrend.filter(bs => bs === 'BIG').length;
      const trendPred = bigTrendCount > 5 ? 'BIG' : 'SMALL';
      const reversalPred = bigSmallHistory[0] === 'BIG' ? 'SMALL' : 'BIG';
      const freqPred = bigTrendCount > 5 ? 'BIG' : 'SMALL'; // Simplified frequency
      const altPred = (bigSmallHistory[0] !== bigSmallHistory[1]) ? reversalPred : trendPred;
      const duoPred = (bigSmallHistory[0] === bigSmallHistory[1]) ? bigSmallHistory[0] : reversalPred;
      const trioPred = (bigSmallHistory[0] === bigSmallHistory[1] && bigSmallHistory[1] === bigSmallHistory[2]) ? reversalPred : trendPred;
      const seqGapPred = bigTrendCount > recentTrend.length / 2 ? 'SMALL' : 'BIG';
      const cyclePred = (bigSmallHistory[0] === bigSmallHistory[3]) ? reversalPred : trendPred;
      const breakoutPred = numbers[0] > Math.max(...numbers.slice(0, 5)) ? 'BIG' : 'SMALL';
      trendBased.push({ name: 'Trend', pred: trendPred, w: 0.15 });
      trendBased.push({ name: 'Reversal', pred: reversalPred, w: 0.10 });
      trendBased.push({ name: 'Frequency', pred: freqPred, w: 0.08 });
      trendBased.push({ name: 'Alternating', pred: altPred, w: 0.07 });
      trendBased.push({ name: 'Duo Streak', pred: duoPred, w: 0.06 });
      trendBased.push({ name: 'Trio Flip', pred: trioPred, w: 0.05 });
      trendBased.push({ name: 'Seq Gap', pred: seqGapPred, w: 0.04 });
      trendBased.push({ name: 'Cycle', pred: cyclePred, w: 0.03 });
      trendBased.push({ name: 'Breakout', pred: breakoutPred, w: 0.05 });
      // Statistical Method (Weight: 0.4 total)
      const recentNums = numbers.slice(0, 10);
      const avg = recentNums.reduce((a, b) => a + b, 0) / recentNums.length;
      const statPred = avg >= 4.5 ? 'BIG' : 'SMALL';
      const volPred = recentNums.reduce((acc, curr, i) => i > 0 ? acc + Math.abs(curr - recentNums[i-1]) : acc, 0) / recentNums.length > 2 ? reversalPred : statPred;
      const rsiPred = (() => { // Simplified RSI
        let gains = 0, losses = 0;
        for (let i = 1; i < 6; i++) {
          const change = numbers[i-1] - numbers[i];
          if (change > 0) gains += change; else losses -= change;
        }
        const rs = (gains / 5) / (losses / 5);
        const rsi = 100 - (100 / (1 + rs));
        return rsi > 70 ? 'SMALL' : (rsi < 30 ? 'BIG' : statPred);
      })();
      const bollPred = (() => { // Simplified Bollinger
        const mean = avg;
        const variance = recentNums.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / recentNums.length;
        const stdDev = Math.sqrt(variance);
        const last = numbers[0];
        if (last > mean + (2 * stdDev)) return 'SMALL';
        if (last < mean - (2 * stdDev)) return 'BIG';
        return statPred;
      })();
      const momPred = ((numbers[0] - numbers[4]) / numbers[4] > 0.1) ? 'BIG' : 'SMALL';
      const wRecentPred = (() => { // Simplified weighted
        let sum = 0, wSum = 0;
        for (let i = 0; i < 5; i++) {
          const w = (i + 1) / 15;
          sum += numbers[i] * w;
          wSum += w;
        }
        return (sum / wSum) >= 4.5 ? 'BIG' : 'SMALL';
      })();
      const harmPred = (() => { // Simplified harmonic
        const sumRecip = recentNums.slice(0, 5).reduce((a, b) => a + (1 / b), 0);
        const hMean = 5 / sumRecip;
        return hMean >= 4.5 ? 'BIG' : 'SMALL';
      })();
      const entPred = (() => { // Simplified entropy
        const bigC = recentTrend.filter(bs => bs === 'BIG').length;
        const pBig = bigC / recentTrend.length;
        const entropy = - (pBig * Math.log2(pBig + 1e-10) + (1 - pBig) * Math.log2(1 - pBig + 1e-10));
        return entropy > 0.9 ? statPred : (bigC > 5 ? 'SMALL' : 'BIG');
      })();
      statistical.push({ name: 'Moving Avg', pred: statPred, w: 0.10 });
      statistical.push({ name: 'Volatility', pred: volPred, w: 0.08 });
      statistical.push({ name: 'RSI', pred: rsiPred, w: 0.07 });
      statistical.push({ name: 'Bollinger', pred: bollPred, w: 0.06 });
      statistical.push({ name: 'Momentum', pred: momPred, w: 0.05 });
      statistical.push({ name: 'Weighted Recent', pred: wRecentPred, w: 0.04 });
      statistical.push({ name: 'Harmonic', pred: harmPred, w: 0.03 });
      statistical.push({ name: 'Entropy', pred: entPred, w: 0.04 });
      // Consensus: Weighted average of both methods
      let bigScore = 0, smallScore = 0;
      [...trendBased, ...statistical].forEach(s => {
        if (s.pred === 'BIG') bigScore += s.w;
        else if (s.pred === 'SMALL') smallScore += s.w;
      });
      const prediction = bigScore > smallScore ? 'BIG' : 'SMALL';
      const totalWeight = bigScore + smallScore;
      let confidence = 50;
      if (totalWeight > 0) {
        const diff = Math.abs(bigScore - smallScore) / totalWeight;
        confidence = 50 + (diff * 50);
      }
      confidence = Math.min(99, Math.max(51, confidence));
      if (new Date().getSeconds() % 10 === 0) confidence -= 2;
      const patterns = [...trendBased, ...statistical]; // All patterns for full display
      if (confidence < SKIP_THRESHOLD) {
        return { prediction: 'SKIP', confidence: 0, patterns };
      }
      return { prediction, confidence, patterns };
    };
    // Games Integration
    function initGames() {
      const gameSelection = document.getElementById('gameSelection');
      const gameFrame = document.getElementById('gameFrame');
      const gameItems = document.querySelectorAll('#tab-games .game-item');
      const injectorTape = document.getElementById('injectorTape');
      gameItems.forEach(item => {
        item.addEventListener('click', function() {
          const gameUrl = this.getAttribute('data-url');
          gameFrame.src = gameUrl;
          gameSelection.style.display = 'none';
          gameFrame.style.display = 'block';
          injectorTape.style.display = 'flex';
          this.classList.add('active');
          setTimeout(() => this.classList.remove('active'), 500);
        });
      });
      injectorTape.addEventListener('click', function() {
        gameFrame.style.display = 'none';
        gameSelection.style.display = "flex";
        injectorTape.style.display = 'none';
        gameFrame.src = '';
      });
      setTimeout(() => {
        document.querySelector('.game-selection-title').classList.add('animate');
      }, 500);
    }
    // Settings Integration
    function initSettings() {
      const modeToggle = document.getElementById('modeToggle');
      const body = document.body;
      const isDark = localStorage.getItem('darkMode') === 'true';
      if (isDark) {
        body.classList.remove('light-mode');
        body.classList.add('dark-mode');
        modeToggle.classList.add('active');
      }
      modeToggle.addEventListener('click', () => {
        if (body.classList.contains('light-mode')) {
          body.classList.remove('light-mode');
          body.classList.add('dark-mode');
          localStorage.setItem('darkMode', 'true');
        } else {
          body.classList.remove('dark-mode');
          body.classList.add('light-mode');
          localStorage.setItem('darkMode', 'false');
        }
        modeToggle.classList.toggle('active');
      });
      document.getElementById('saveSettingsBtn').addEventListener('click', () => {
        const botToken = document.getElementById('botToken').value;
        const chatId = document.getElementById('chatId').value;
        localStorage.setItem('botToken', botToken);
        localStorage.setItem('chatId', chatId);
        alert('Settings saved!');
      });
      // Auto Button - Proper Sequence: Start Msg + Sticker, then predictions one by one
      const autoBtn = document.getElementById('startAutoBtn');
      autoBtn.addEventListener('click', async () => {
        const botToken = localStorage.getItem('botToken');
        const chatId = localStorage.getItem('chatId');
        if (!botToken || !chatId) {
          alert('Please save Bot Token and Chat ID first.');
          return;
        }
        if (!isAutoRunning) {
          // Send start message and sticker first
          await sendTelegramMessage(botToken, chatId, START_MSG);
          await sendTelegramSticker(botToken, chatId, STICKERS.start);
          // Then send first prediction
          await sendPrediction(botToken, chatId);
          // Set interval for next predictions (one by one every 5s)
          autoInterval = setInterval(async () => await sendPrediction(botToken, chatId), 5000);
          isAutoRunning = true;
          autoBtn.textContent = 'Stop Auto';
          autoBtn.classList.add('running');
        } else {
          stopAuto();
        }
      });
      // Theme selection
      document.querySelectorAll('.theme-item').forEach(item => {
        item.addEventListener('click', function() {
          document.querySelectorAll('.theme-item').forEach(i => i.classList.remove('active'));
          this.classList.add('active');
          const theme = this.dataset.theme;
          applyTheme(theme);
        });
      });
      // Load saved settings
      document.getElementById('botToken').value = localStorage.getItem('botToken') || '';
      document.getElementById('chatId').value = localStorage.getItem('chatId') || '';
    }
  </script>
</body>
</html>
